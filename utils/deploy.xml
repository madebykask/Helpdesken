<!-- 
How to run: 
	%WINDIR%\Microsoft.NET\Framework64\v4.0.30319\MSBuild.exe /toolsversion:4.0 deploy.xml
-->
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" Tools="2.0">
	<PropertyGroup>		
		<PublishedFolder>C:\Download\published\</PublishedFolder>
		<DevPath>\\dhutvas3\Websites\dhHelpdesk\</DevPath>
		<AcctPath>\\dhutvas3\Websites\dhHelpdeskAcct\</AcctPath>
		<TestPath>I:\tmp\_testdeploy\</TestPath>
		<TargetPath>$(DevPath)</TargetPath>                               	
		<AppOfflineDisabled>$(TargetPath)\_app_offline.htm</AppOfflineDisabled>
		<AppOfflineEnabled>$(TargetPath)\app_offline.htm</AppOfflineEnabled>
		<BackupFolder>$(TargetPath)\bak\</BackupFolder>
	</PropertyGroup>

	<ItemGroup>
		<!-- Files and folders to backup -->
		<Backup Include="$(TargetPath)\**\*" 
			Exclude="$(TargetPath)\*.*;
				$(TargetPath)\bak\**\*;
				$(TargetPath)\App_Data\**\*;
				$(TargetPath)\Documents\**\*;
				$(TargetPath)\ExportedInvoice\**\*;
				$(TargetPath)\img-profile\**\*;
				$(TargetPath)\uploaded_file\**\*;
				$(TargetPath)\_app_offline.htm;
				$(TargetPath)\app_offline.htm;
				$(TargetPath)\log4net.config;
				$(TargetPath)\Web.config" />

		<FilesToDeploy Include="$(PublishedFolder)\**\*"
			Exclude="$(PublishedFolder)\*.*;
				$(PublishedFolder)\bak\**\*;
				$(PublishedFolder)\App_Data\**\*;
				$(PublishedFolder)\Documents\**\*;
				$(PublishedFolder)\ExportedInvoice\**\*;
				$(PublishedFolder)\img-profile\**\*;
				$(PublishedFolder)\uploaded_file\**\*;
				$(PublishedFolder)\_app_offline.htm;
				$(PublishedFolder)\app_offline.htm;
				$(PublishedFolder)\log4net.config;
				$(PublishedFolder)\Web.config" />

		<FilesToZip Include="\\servername\f$\web\example.com\wwwroot\**\*.*" />	
	</ItemGroup>

	<Target Name="Deploy">
		<Message Text="==========  Starting copying content to target  ============" />
		<Move SourceFiles="@(FilesToDeploy)" DestinationFolder="$(TargetPath)\%(RecursiveDir)" /> 
	</Target>

	<Target Name="Backup" BeforeTargets="Deploy">
		<!--Message Text="Backing up old content $(BackupFolder)\%(Backup.RecursiveDir)"/ -->
		<RemoveDir Directories="$(BackupFolder)" />
		<MakeDir Directories="$(BackupFolder)" />
		<Move SourceFiles="@(Backup)" DestinationFolder="$(BackupFolder)\%(RecursiveDir)" /> 
		<RemoveDir Directories="@(Backup->'%(RootDir)%(Directory)');$(TargetPath)\Areas\" />	
	</Target>

	<Target Name="TakeOffline" BeforeTargets="Backup">
		<Message Text="========== Set site to offline =============="/>
		<Move SourceFiles="$(AppOfflineDisabled)" DestinationFiles="$(AppOfflineEnabled)" />			
	</Target>

	<Target Name="TakeOnline" AfterTargets="Deploy">
		<Message Text="========== Set site to online =============="/>
		<Move SourceFiles="$(AppOfflineEnabled)" DestinationFiles="$(AppOfflineDisabled)" />		
	</Target>

	<Target Name="Zip">
		<Zip Files="@(FilesToZip)" 
			ZipFileName="\\servername\f$\web\example.com\backup$(Timestamp).zip"
			WorkingDirectory="\\servername\f$\web\example.com\wwwroot" />
	</Target>
 
     <Target Name="Build" DependsOnTargets="Clean">
	<Message Text="Clean"/>
     </Target>
</Project>