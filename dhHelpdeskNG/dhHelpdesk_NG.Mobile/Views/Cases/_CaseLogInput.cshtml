@model DH.Helpdesk.Mobile.Models.Case.CaseInputViewModel 
@using DH.Helpdesk.BusinessData.OldComponents
@using DH.Helpdesk.Common.Enums.Settings
@using DH.Helpdesk.Mobile.Infrastructure.Extensions
@using DH.Helpdesk.Mobile.Infrastructure.Extensions.HtmlHelperExtensions

                        
<h4>
    @if (Model.case_.CaseNumber > 0)
    {
        @Translation.Get("Ärende") <span>@Model.case_.CaseNumber - </span>
    }
    @if (Model.CaseLog.Id == 0) 
    {
        @Translation.Get("Kommunikation")
    }            
    else
    {
        @Translation.Get("Kommunikation")
    }        
</h4>
<div class="secnavs secnavmarg">
    <div class="pull-left">
        <ul class="secnav">
            <li>
                <div class="checkbox">
                    @if (Model.Disable_SendMailAboutCaseToNotifier)
                    {                        
                        @Html.CheckBoxFor(model => model.CaseLog.SendMailAboutCaseToNotifier, 
                                new { @disabled = "disabled", InformNotifierBehavior = Model.InformNotifierBehavior.ToJavaScriptBool() })
                    }
                    else
                    {
                        @Html.CheckBoxFor(model => model.CaseLog.SendMailAboutCaseToNotifier,
                                new {  InformNotifierBehavior = Model.InformNotifierBehavior.ToJavaScriptBool() }) 
                    }
                    <span class="lbl">@Translation.Get("Informera anmälaren om åtgärden") </span>
                </div>                                    
            </li>
            <li class="secspace"></li>
            <li>
                <div class="checkbox">
                    @Html.CheckBoxFor(model => model.CaseLog.HighPriority)
                    <span class="lbl">@Translation.Get("Hög prioritet") </span>
                </div> 
            </li>
            @if (Model.CaseLog.Id == 0) 
            {                
                if (Model.standardTexts != null)                    
                {                    
                    if (Model.standardTexts.Any())
                    {                        
                        <li class="secspace"></li>
                        <li>
                            @Translation.Get("Standardtext")&nbsp;
                            <select id="lstStandarTexts">
                                <option>&nbsp;</option>
                                @foreach (var e in Model.standardTexts.Where(e => e.IsActive == 1))
                                {
                                    <option value="@e.Id">@e.Name</option>
                                }
                            </select>
                        </li>
                    }                    
                }                
            }    
        </ul>
    </div>
</div>

            <p style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.tblLog_Text_External, CaseSolutionFields.ExternalLogNote)">                                        
                <label>
                    @CaseFieldCaption(GlobalEnums.TranslationCaseFields.tblLog_Text_External) 
                </label>
                    @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.Description, CaseSolutionFields.Description))
                    {
                        @Html.TextAreaFor(model => model.CaseLog.TextExternal, new { style = "height:105px;" })
                    }
                    else
                    {
                        @Html.TextAreaFor(model => model.CaseLog.TextExternal, new { style = "height:105px;", @readonly = true })
                    }
                    @Html.HiddenFor(model => model.CaseLog.RegUser)  
                    @Html.HiddenFor(model => model.CaseLog.LogType)  
                    @Html.HiddenFor(model => model.CaseLog.UserId)  
                    @Html.HiddenFor(model => model.CaseLog.Id)  
                    @Html.HiddenFor(model => model.CaseLog.CaseId)  
                    @Html.HiddenFor(model => model.CaseLog.LogGuid)  
                    @Html.HiddenFor(model => model.LogKey)
            </p>
            <p style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.tblLog_Text_Internal, CaseSolutionFields.InternalLogNote)">
                <label>
                    @CaseFieldCaption(GlobalEnums.TranslationCaseFields.tblLog_Text_Internal) 
                </label>
                    @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.Description, CaseSolutionFields.Description))
                    {
                        @Html.TextAreaFor(model => model.CaseLog.TextInternal, new { style = "height:105px;" })
                    }
                    else
                    {
                        @Html.TextAreaFor(model => model.CaseLog.TextInternal, new { style = "height:105px;", @readonly = true })
                    }
                    <div class="checkbox">
                        @Html.CheckBoxFor(model => model.CaseLog.SendMailAboutLog)  
                        <span class="lbl">@Translation.Get("Skicka intern loggpost till")</span>
                    </div>
                    <div id="divEmailRecepientsInternalLog" style="display:none">
                        @Html.TextAreaFor(model => model.CaseLog.EmailRecepientsInternalLog, new { @readonly="readonly"})
                    </div>
            </p>
            <p style="@Model.caseFieldSettings.displayHtml(GlobalEnums.TranslationCaseFields.tblLog_Filename.ToString())">

            </p>
            @if (Model.CaseLog.Id == 0) 
            {                                        
                <p>
                    <label>
                        @CaseFieldCaption(GlobalEnums.TranslationCaseFields.tblLog_Filename) 
                    </label>
                            <a href="#upload_logfiles_popup" role="button" class="btn" data-toggle="modal">@Translation.Get("Lägg till")</a>
                </p>                
            }
            <p>
                    <div id="divCaseLogFiles">
                        @Html.Partial("_CaseLogFiles", Model.LogFilesModel)
                    </div>
            </p>
            <p style="@Model.caseFieldSettings.displayHtml(GlobalEnums.TranslationCaseFields.FinishingDescription.ToString())">
                <label>
                    @CaseFieldCaption(GlobalEnums.TranslationCaseFields.FinishingDescription) 
                    @if (Model.caseFieldSettings.getCaseSettingsValue(GlobalEnums.TranslationCaseFields.FinishingDescription.ToString()).Required == 1)
                    {
                        <span class="mandatorystar">*</span>
                    }                                            
                </label>
                    @Html.TextAreaFor(model => model.case_.FinishingDescription)
            </p>
            <p style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.ClosingReason, CaseSolutionFields.FinishingCause)">
                <label>
                    @CaseFieldCaption(GlobalEnums.TranslationCaseFields.ClosingReason) 
                </label>
                    <div id="divFinishingType" class="btn-group">
                        @{
                            string disabled = Model.GetDisabledString(GlobalEnums.TranslationCaseFields.ClosingReason, CaseSolutionFields.FinishingCause);
                        }
                        <div class="btn @disabled" id="divBreadcrumbs_FinishingType">@Translation.Get("--")</div>
                        <button class="btn dropdown-toggle" data-toggle="dropdown" @disabled>
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu dropup">
                            <li><a href="#">@Translation.Get("--")</a></li>
                            @Html.FinishingCauseDropdownButtonString(Model.finishingCauses)
                        </ul>
                        @Html.HiddenFor(model => model.CaseLog.FinishingType)
                    </div>
            </p>
            <p>
                <label>
                    @CaseFieldCaption(GlobalEnums.TranslationCaseFields.FinishingDate) 
                </label>
                    @Html.EditorFor(m => m.CaseLog.FinishingDate, "DatePicker", new { id = "divCaseLog_FinishingDate" })
            </p>

<div id="divInvoice" style="@Model.ShowInvoiceFields.displayHtml()">
    <h4>
        @Translation.Get("Fakturering")
    </h4>
                <p>
                    <label class="span3" >
                        @Translation.Get("Tidsåtgång") 
                    </label>
                        <select id="CaseLog_WorkingTimeHour" name="CaseLog.WorkingTimeHour" Class="inputw100">
                        @for (var i = 0; i < 100; i++)  
                        {
                            <option value="@i.ToString()" @i.IdIsSelected(Model.CaseLog.WorkingTimeHour.ToString()) >@i.ToString()</option>
                        }
                        </select>&nbsp;@Translation.Get("Tim")&nbsp; 

                        <select id="CaseLog_WorkingTimeMinute" name="CaseLog.WorkingTimeMinute" Class="inputw100">
                        @for (var i = 0; i < 59; i = i + Model.MinWorkingTime)  
                        {
                            <option value="@i.ToString()" @i.IdIsSelected(Model.CaseLog.WorkingTimeMinute.ToString()) >@i.ToString()</option>
                        }
                        </select>&nbsp;@Translation.Get("Min")
                </p>
                <p>
                    <label>
                        @Translation.Get("Material") 
                    </label>
                        @Html.TextBoxFor(model => model.CaseLog.EquipmentPrice, new { maxlength = "12"} )
                </p>
                <p>
                    <label>
                        @Translation.Get("Pris") 
                    </label>
                        @Html.TextBoxFor(model => model.CaseLog.Price, new { maxlength = "8" })
                </p>
                <p>
                    <label>
                        @Translation.Get("Debitering") 
                    </label>
                        <div class="checkbox">
                            <label>
                                <input name="form-field-checkbox" type="checkbox" />
                                @Html.CheckBoxFor(model => Model.CaseLog.Charge)
                                <span class="lbl">@Translation.Get("Debitera kunden för genomförd åtgärd")</span>
                            </label>
                        </div> 
                </p>                          
</div>

@Html.Partial("_SendToDialog", Model.SendToDialogModel)


@functions    {

    private MvcHtmlString CaseFieldCaption(GlobalEnums.TranslationCaseFields field)
    {
        return Html.CaseFieldCaption(
                    Model.caseFieldSettings,
                    Model.CaseFieldSettingWithLangauges,
                    field,
                    Model.case_.Customer_Id);
    }    

}

