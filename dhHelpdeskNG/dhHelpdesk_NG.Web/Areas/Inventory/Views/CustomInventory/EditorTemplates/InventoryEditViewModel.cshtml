@using System.Web.Optimization
@using DH.Helpdesk.BusinessData.Models.Inventory.Edit.Inventory
@using DH.Helpdesk.Web.Areas.Inventory.Models.EditModel.Inventory
@using DH.Helpdesk.Web.Infrastructure
@model InventoryEditViewModel
@functions {

    private bool IsVisibleGeneral()
    {
        return Model.InventoryViewModel.DefaultFieldsViewModel.DefaultFieldsModel.DepartmentId.Show || Model.InventoryViewModel.DefaultFieldsViewModel.DefaultFieldsModel.Name.Show || Model.InventoryViewModel.DefaultFieldsViewModel.DefaultFieldsModel.Model.Show || Model.InventoryViewModel.DefaultFieldsViewModel.DefaultFieldsModel.Manufacturer.Show || Model.InventoryViewModel.DefaultFieldsViewModel.DefaultFieldsModel.SerialNumber.Show || Model.InventoryViewModel.DefaultFieldsViewModel.DefaultFieldsModel.TheftMark.Show;
    }

    private bool IsVisibleInventory()
    {
        return Model.InventoryViewModel.DefaultFieldsViewModel.DefaultFieldsModel.BarCode.Show || Model.InventoryViewModel.DefaultFieldsViewModel.DefaultFieldsModel.PurchaseDate.Show;
    }

}
@Scripts.Render("~/bundles/inventory/place-cascading")

<script>
    $(function () {
        var parameters = {
            floorsSearchUrl: '@Url.Action("SearchFloorsByBuildingId")',
            roomsSearchUrl: '@Url.Action("SearchRoomsByFloorId")'
        };

        applyCascadingBehivarior(parameters);
    });
</script>

@if (IsVisibleGeneral())
{
    <h4>@Translation.Get("Allmänt")</h4>

    <div class="row">
        <div class="span12">
            <table class="tableform">
                @Html.EditorFor(m => m.InventoryViewModel.DefaultFieldsViewModel.DefaultFieldsModel.DepartmentId, "CustomTypesFields/List", new { Source = Model.InventoryViewModel.DefaultFieldsViewModel.Departments })
                @Html.EditorFor(m => m.InventoryViewModel.DefaultFieldsViewModel.DefaultFieldsModel.Name, "CustomTypesFields/Text")
                @Html.EditorFor(m => m.InventoryViewModel.DefaultFieldsViewModel.DefaultFieldsModel.Model, "CustomTypesFields/Text")
                @Html.EditorFor(m => m.InventoryViewModel.DefaultFieldsViewModel.DefaultFieldsModel.Manufacturer, "CustomTypesFields/Text")
                @Html.EditorFor(m => m.InventoryViewModel.DefaultFieldsViewModel.DefaultFieldsModel.SerialNumber, "CustomTypesFields/Text")
                @Html.EditorFor(m => m.InventoryViewModel.DefaultFieldsViewModel.DefaultFieldsModel.TheftMark, "CustomTypesFields/Text")
            </table>
        </div>
    </div>
}

@if (IsVisibleInventory())
{
    <h4>@Translation.Get("Inventering")</h4>
    
    <div class="row">
        <div class="span12">
            <table class="tableform">
                @Html.EditorFor(m => m.InventoryViewModel.DefaultFieldsViewModel.DefaultFieldsModel.BarCode, "CustomTypesFields/Text")
                @Html.EditorFor(m => m.InventoryViewModel.DefaultFieldsViewModel.DefaultFieldsModel.PurchaseDate, "CustomTypesFields/Date", new { id = "inventory_edit_purchasedate_date_datepicker" })
                @Html.EditorFor(m => m.InventoryViewModel.DefaultFieldsViewModel.DefaultFieldsModel.Info, "CustomTypesFields/WideText")
            </table>
        </div>
    </div>
}
@if (Model.InventoryViewModel.DefaultFieldsViewModel.DefaultFieldsModel.RoomId.Show)
{
    <h4>@Translation.Get("Placering")</h4>
}
@if (Model.InventoryViewModel.DefaultFieldsViewModel.DefaultFieldsModel.RoomId.Show)
{
    <div class="row">
        <div class="span12">
            <table class="tableform">
                <tr>
                    <td class="span3">
                        <label>@Translation.Get("Byggnad")</label>
                    </td>
                    <td class="span9">
                        @Html.DropDownListFor(m => m.InventoryViewModel.DefaultFieldsViewModel.DefaultFieldsModel.BuildingId, Model.InventoryViewModel.DefaultFieldsViewModel.Buildings, string.Empty, new { id = "buildings_dropdown" })
                    </td>
                </tr>
                <tr>
                    <td class="span3">
                        <label>@Translation.Get("Våning")</label>
                    </td>
                    <td class="span9">
                        @Html.DropDownListFor(m => m.InventoryViewModel.DefaultFieldsViewModel.DefaultFieldsModel.FloorId, Model.InventoryViewModel.DefaultFieldsViewModel.Floors, string.Empty, new { id = "floors_dropdown" })
                    </td>
                </tr>
                <tr>
                    @Html.EditorFor(m => m.InventoryViewModel.DefaultFieldsViewModel.DefaultFieldsModel.RoomId, "CustomTypesFields/List", new { Source = Model.InventoryViewModel.DefaultFieldsViewModel.Rooms, id = "rooms_dropdown" })
                </tr>
            </table>
        </div>
    </div>
}

@{
    List<int> groups = Model.DynamicFieldModels.Select(x => x.GroupId).Distinct().OrderBy(x => x).ToList();
    List<DynamicFieldModel> allModels = Model.DynamicFieldModels.OrderBy(x => x.GroupId).ThenBy(x => x.Position).ToList();

    foreach (var group in groups)
    {
        int id = group;
        var dynamicFieldModels = Model.DynamicFieldModels.Where(x => x.GroupId == id).OrderBy(x => x.Position).ToList();

        if (!dynamicFieldModels.Any())
        {
            continue;
        }

        TypeGroupModel groupName = Model.TypeGroupModels.FirstOrDefault(x => x.Id == group);

        string header = groupName != null ? groupName.Name : string.Empty;
        <h4>@Html.DisplayFor(m => header)</h4>

        <div class="row">
            <div class="span12">
                <table class="tableform">
                    @for (int i = 0; i < allModels.Count; i++)
                    {
                        if (dynamicFieldModels.Contains(allModels[i]))
                        {
                            @Html.EditorFor(m => allModels[i], "DynamicFieldModel", new { Id = i })
                        }
                    }
                </table>
            </div>
        </div>
    }
}