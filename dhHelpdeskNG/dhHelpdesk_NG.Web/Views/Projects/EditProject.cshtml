@using dhHelpdesk_NG.Web.Models.Projects
@model UpdatedProjectViewModel
<div class="secnavs">
    <div class="pull-left">
        <ul class="secnav">
            <li id="menu1">
                <input type="submit" value="@Translation.Get("Save Project", Enums.TranslationSource.TextTranslation)" class="btn" onclick="$('#project_edit_form').submit();"/>
            </li>
            <li id="menu2">@Html.ActionLink(Translation.Get("Cancel", Enums.TranslationSource.TextTranslation), "Index", null, new { @class = "btn" })</li>
            <li id="menu3">@Html.ActionLink(Translation.Get("Delete Project", Enums.TranslationSource.TextTranslation), "DeleteProject", new { id = Model.ProjectEditModel.Id }, new { @class = "btn" })</li>
        </ul>
    </div>
</div>

<div class="content">
    <div class="container">
        <ul class="nav nav-tabs" id="project_tab">
            <li class="active">
                <a href="#fragment-1">@Translation.Get("Project", Enums.TranslationSource.TextTranslation)</a>
            </li>
            <li>
                <a href="#fragment-2">@Translation.Get("Log", Enums.TranslationSource.TextTranslation)</a>
            </li>
            <li>
                <a href="#fragment-3">@Translation.Get("Cases", Enums.TranslationSource.TextTranslation)</a>
            </li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane tab-pane-border active" id="fragment-1">
                @using (Html.BeginForm("EditProject", "Projects", FormMethod.Post, new { id = "project_edit_form" }))
                {   
                    @Html.ValidationSummary(true)
                    @Html.Partial("_InputProject", new NewProjectViewModel { ProjectEditModel = Model.ProjectEditModel, Users = Model.Users })
                }
                <div class="secnavs">
                    <div class="pull-left">
                        <ul class="secnav">
                            @if (Model.UpdatedProjectScheduleEditModel.ProjectScheduleEditModels.Any())
                            {
                                <li>
                                    <input type="submit" value="@Translation.Get("Save Schedules", Enums.TranslationSource.TextTranslation)" class="btn" onclick="$('#project_schedules_edit_form').submit();"/>
                                </li>
                            }
                            <li>
                                <input type="submit" value="@Translation.Get("Add Schedule", Enums.TranslationSource.TextTranslation)" class="btn" onclick="$('#project_schedule_edit_form').submit();"/>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="content">
                    <div class="container">
                        <ul class="nav nav-tabs">
                            <li class="active">
                                <a href="#fragment-1">@Translation.Get("Project Schedules", Enums.TranslationSource.TextTranslation)</a>
                            </li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane tab-pane-border active">
                                @using (Html.BeginForm("AddProjectSchedule", "Projects", FormMethod.Post, new { id = "project_schedule_edit_form" }))
                                {   
                                    @Html.ValidationSummary(true)
                                    @Html.Partial("EditorTemplates/NewProjectScheduleEditModel", Model.NewProjectScheduleEditModel)
                                }
                                @using (Html.BeginForm("EditProjectSchedules", "Projects", new { projectId = Model.ProjectEditModel.Id }, FormMethod.Post, new { id = "project_schedules_edit_form" }))
                                {

                                    @Html.ValidationSummary(true)
                                    @Html.Partial("ProjectScheduleGrid", Model.UpdatedProjectScheduleEditModel)  
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane tab-pane-border" id="fragment-2">
                @using (Html.BeginForm("AddProjectLog", "Projects", FormMethod.Post, new { id = "log_edit_form" }))
                {
                    @Html.EditorFor(x => x.ProjectLog)
                    <input type="submit" value="@Translation.Get("Add Log", Enums.TranslationSource.TextTranslation)" class="btn"/>
                }
                @Html.Partial("LogGrid", Model.ProjectLogs)
            </div>
            <div class="tab-pane tab-pane-border" id="fragment-3">
                @Html.Partial("CaseGrid", Model.CaseOverviews)
            </div>
        </div>
    </div>
</div>

<input type="hidden" name="activeTab" id="activeTab" value="@SessionFacade.ActiveTab" />

<script type="text/javascript">

    $.validator.setDefaults({
        ignore: ""
    });

    $('#project_tab a[href="' + $('#activeTab')[0].value + '"]').tab('show');

</script>
