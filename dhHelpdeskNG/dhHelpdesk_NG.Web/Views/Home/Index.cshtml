@using System.Web.Optimization
@using DH.Helpdesk.BusinessData.Enums.Users
@model DH.Helpdesk.Web.Models.HomeIndexViewModel
@{
    ViewBag.Title = "Helpdesk start page";
}

@Scripts.Render("~/bundles/modules")

<div id="mainContainer" class="content nonemenu">
    <div class="container">
        <div class="row-fluid">                        
            <div class="span4">
                <div class="tab-content">
                    <div class="tab-pane active" id="fragment-1">
                        <div class="container">
                            <span class="toolt" data-toggle="tooltip"></span>
                            <div class="column" data-usermodules-column="1">                                
                            </div>    
                        </div>
                    </div>
                </div>
            </div>
            <div class="span4 ">
                <div class="tab-content">
                    <div class="tab-pane active" id="fragment-3">
                        <div class="container">
                            <div class="column" data-usermodules-column="2">
                            </div>                                
                        </div>
                    </div>
                </div>
            </div>
            <div class="span4">
                <div class="tab-content">
                    <div class="tab-pane active" id="fragment-4">
                        <div class="container">
                            <div class="column" data-usermodules-column="3">
                            </div>                                                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3>&nbsp;</h3>
    </div>
    <div class="modal-body">
        <form>
            <div id="uploader">
                <p>You browser doesn't have Flash, Silverlight, Gears, BrowserPlus or HTML5 support.</p>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">@Translation.Get("Stäng", Enums.TranslationSource.TextTranslation)</button>
    </div>
</div>

<div class="startpage-brand" style="display: none;"></div>

<input type="button" value="Get Request" name="btnRequest1" id="btnRequest1" class="btn btn-large btn-warning" style="width:100%;" />
<input type="button" value="Post Request" name="btnRequest2" id="btnRequest2" class="btn btn-large btn-warning" style="width:100%;" />

<div style="display: none;"
    data-usermodules="items"
    data-usermodules-userid="@(Model.UserId)" >
    <div class="portlet customers" 
        data-usermodules="item" 
        data-usermodules-moduleid="@(GetModuleId(Module.Customers))"
        data-usermodules-position="@(GetModulePosition(Module.Customers))">
        @{
            Html.RenderPartial("CustomersInfo", Model.CustomersInfo);
        }                                                                        
    </div>                                        
    <div class="portlet changemanagement" 
        data-usermodules="item" 
        data-usermodules-moduleid="@(GetModuleId(Module.ChangeManagement))"
        data-usermodules-position="@(GetModulePosition(Module.ChangeManagement))">
        @{
            Html.RenderPartial("ChangesInfo", Model.CustomerChanges);
        }                                                                        
    </div>                                        
    <div class="portlet problems" 
        data-usermodules="item" 
        data-usermodules-moduleid="@(GetModuleId(Module.Problems))"
        data-usermodules-position="@(GetModulePosition(Module.Problems))">
        @{
            Html.RenderPartial("ProblemsInfo", Model.ProblemOverviews);
        }                                                                        
    </div>                                        
    <div class="portlet statistics" 
        data-usermodules="item" 
        data-usermodules-moduleid="@(GetModuleId(Module.Statistics))"
        data-usermodules-position="@(GetModulePosition(Module.Statistics))">
        @{
            Html.RenderPartial("StatisticsInfo", Model.StatisticsOverviews);
        }                                                                                                        
    </div>                                        
    <div class="portlet bulletinboard" 
        data-usermodules="item" 
        data-usermodules-moduleid="@(GetModuleId(Module.BulletinBoard))"        
        data-usermodules-position="@(GetModulePosition(Module.BulletinBoard))">
        @{
            Html.RenderPartial("BulletinBoardInfo", Model.BulletinBoardOverviews);
        }                                                                                                    
    </div>                                        
    <div class="portlet calendar" 
        data-usermodules="item" 
        data-usermodules-moduleid="@(GetModuleId(Module.Calendar))"
        data-usermodules-position="@(GetModulePosition(Module.Calendar))">
        @{
            Html.RenderPartial("CalendarsInfo", Model.CalendarOverviews);
        }                                                                        
    </div>                                        
    <div class="portlet faq" 
        data-usermodules="item" 
        data-usermodules-moduleid="@(GetModuleId(Module.Faq))"
        data-usermodules-position="@(GetModulePosition(Module.Faq))">
        @{
            Html.RenderPartial("FaqInfo", Model.FaqOverviews);
        }                                                                        
    </div>                                        
    <div class="portlet operartionallog" 
        data-usermodules="item" 
        data-usermodules-moduleid="@(GetModuleId(Module.OperationalLog))"
        data-usermodules-position="@(GetModulePosition(Module.OperationalLog))">
        @{
            Html.RenderPartial("OperationLogsInfo", Model.OperationLogOverviews);
        }                                                                                                                                
    </div>                                        
    <div class="portlet dailyreport" 
        data-usermodules="item" 
        data-usermodules-moduleid="@(GetModuleId(Module.DailyReport))"
        data-usermodules-position="@(GetModulePosition(Module.DailyReport))">
        @{
            Html.RenderPartial("DailyReportsInfo", Model.DailyReportOverviews);
        }                                                                                                                                
    </div>                                        
    <div class="portlet quicklinks" 
        data-usermodules="item" 
        data-usermodules-moduleid="@(GetModuleId(Module.QuickLinks))"
        data-usermodules-position="@(GetModulePosition(Module.QuickLinks))">
        @{
            Html.RenderPartial("LinksInfo", Model.LinksInfo);
        }                                                                                                                                
    </div>                                        
    <div class="portlet documents" 
        data-usermodules="item" 
        data-usermodules-moduleid="@(GetModuleId(Module.Documents))"
        data-usermodules-position="@(GetModulePosition(Module.Documents))">
        @{
            Html.RenderPartial("DocumentsInfo", Model.DocumentOverviews);
        }                                                                                            
    </div>                                        
    <div class="cases" 
        data-usermodules="item" 
        data-usermodules-moduleid="@(GetModuleId(Module.Cases))"
        data-usermodules-position="@(GetModulePosition(Module.Cases))">
        @{
            Html.RenderPartial("MyCasesInfo", Model.MyCases);
        }                                                                                            
    </div>                                        
</div>
@functions
{

    private int GetModuleId(Module module)
    {
        var userModule = Model.UserModules.FirstOrDefault(m => m.Module_Id == (int) module);
        if (userModule == null)
            return 0;
        return userModule.Module_Id;
    }         
    
    private int GetModulePosition(Module module)
    {
        var userModule = Model.UserModules.FirstOrDefault(m => m.Module_Id == (int) module);
        if (userModule == null)
            return 101;
        return userModule.Position;
    }         

}

<script type="text/javascript">
    $('#btnRequest1').click(function () {
        request1();
    });

    $('#btnRequest2').click(function () {
        request2();
    });

    function request1() {
        var _token = localStorage.getItem('AccessToken');

        $.ajax({
            url: "@Url.Content("~/Api/CaseApi/GetCase?id=95879")",
            type: 'GET',
            headers: { "Authorization": "Bearer " + _token },
            error: function (request, status, error) {
                alert(request.responseText);
            },
            success: function (res, status, xhr) {
            }
        });
    };

    function request2() {
        var _token = localStorage.getItem('AccessToken');
        if (_token == null || _token == "") {
            alert("Not authenticated!");
            return;
        }

        var data1 = {
            Id: 0,
            CaseGUID: "5d843789-7049-4c7e-b60b-4b129eb7fff6",
            Caption: "Majid1",
            Customer_Id: "29",
            CaseType_Id: 93,
            ProductAreaSetDate:"2017-05-12T12:41:55",
            PersonsEmail: "mg@dhsolutions.se",
            CurrentLanguageId: 1,
            test: "JJ",
            CaseNumber: 12,
            mm: null
        };

        $.ajax({
            url: "@Url.Content("~/Api/CaseApi/SaveCase")",
            data: JSON.stringify(data1),
            contentType: "application/json; charset=utf-8",
            type: 'POST',
            headers: { "Authorization": "Bearer " + _token }
        });
    };

    function UpdateLogo() {
        var columns = $(".span4");
        $("#mainContainer").find(".startpage-brand").remove();
        var logo = $(".startpage-brand").clone();
        for (var i = 0; i < columns.length; i++) {
            var column = $(columns[i]);
            var columnLogo = column.find(".startpage-brand");
            if (column.find(".portlet-content").length == 0) {
                if (columnLogo.length == 0) {
                    column.find(".tab-content").before(logo);
                    logo.show();
                    break;
                }
            }
        }
    }

    $(function () {
        $(".column").sortable({
            connectWith: ".column",
            handle: ".portlet-header",
            cancel: ".portlet-toggle",
            placeholder: "portlet-placeholder",
            revert: true,
            beforeStop: function (event, ui) {
                //UpdateLogo();
                $(document).trigger("OnUserModuleItemMoved", [ ui ]);
            }
        });

        //UpdateLogo();
    });
</script>