@model DH.Helpdesk.Web.Models.Case.CaseInputViewModel
@using DH.Helpdesk.Web.Infrastructure

@section Scripts {
<script type="text/javascript">

     $(document).ready(function () {
         CaseInitForm();
     });

</script>
}

@Html.Partial("_Plupload")

@if (Html.MasterModel() != null && SessionFacade.CurrentUser != null && Model != null)
{    
    using (Html.BeginForm("edit", "cases", null, FormMethod.Post, new { id = "target" }))
    {    
    <div class="secnavs fixed">
        <div class="pull-left">
            <ul class="secnav">
                @if (Model.EditMode)
                {
                    <li>@Html.ActionLink(Translation.Get("Spara", Enums.TranslationSource.TextTranslation), null, null, null, new { onclick = "$('#target').submit();return false;", @class = "btn" })</li>
                    <li>@Html.ActionLink(Translation.Get("Spara och stäng", Enums.TranslationSource.TextTranslation), null, null, new { onclick = "EditCaseAndClose();return false;", @class = "btn" })</li>
                    <li>@Html.ActionLink(Translation.Get("Spara", Enums.TranslationSource.TextTranslation) + "/" + Translation.Get("Nytt ärende", Enums.TranslationSource.TextTranslation), null, null, new { onclick = "EditCaseAndAddCase();return false;", @class = "btn" })</li>
                    <li class="secspace"></li>
                    if (SessionFacade.CurrentUser.DeleteCasePermission == 1)
                    {                            
                        <li>@Html.ActionLink(Translation.Get("Ta bort", Enums.TranslationSource.TextTranslation), "DeleteCase", new { caseId = @Model.case_.Id, customerId = @Model.case_.Customer_Id }, new { @class = "btn deleteDialog", deleteDialogText = Translation.Get("Är du säker på att du vill ta bort aktuellt ärende och tillhörande loggposter", Enums.TranslationSource.TextTranslation) })</li>
                    }
                }
                <li>@Html.ActionLink(Translation.Get("Avbryt", Enums.TranslationSource.TextTranslation), "Index", new { customerId = @Model.case_.Customer_Id }, new { @class = "btn" })</li>
                <li>
                    <div class="btn-group">
                        <button class="btn">@Translation.Get("Åtgärder", Enums.TranslationSource.TextTranslation)</button>
                        <button class="btn dropdown-toggle" data-toggle="dropdown">
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu">
                        @if (SessionFacade.CurrentUser.ActivateCasePermission == 1 && Model.case_.FinishingDate.HasValue)
                        {                                
                            <li><a href="#">@Translation.Get("Aktivera", Enums.TranslationSource.TextTranslation)</a></li>
                        }   
                        @if (Model.EditMode)
                        {
                            if (SessionFacade.CurrentUser.MoveCasePermission == 1)
                            {                                
                                <li><a href="#">@Translation.Get("Flytta", Enums.TranslationSource.TextTranslation)</a></li>
                                <li><a href="#">@Translation.Get("Flytta ärende till annan site", Enums.TranslationSource.TextTranslation)</a></li>
                            }
                            if (SessionFacade.CurrentUser.CopyCasePermission == 1)
                            {                                
                                <li><a href="#">@Translation.Get("Kopiera", Enums.TranslationSource.TextTranslation)</a></li>
                            }
                            if (SessionFacade.CurrentUser.FollowUpPermission == 1)
                            {                                
                                if (Model.case_.FollowUpDate.HasValue)
                                {
                                    <li><a href="#">@Translation.Get("Ta bort uppföljning", Enums.TranslationSource.TextTranslation)</a></li>
                                }
                                else
                                {
                                    <li><a href="#">@Translation.Get("Följ upp", Enums.TranslationSource.TextTranslation)</a></li>
                                }
                            }
                            if (Html.MasterModel().CustomerSetting.ModuleChangeManagement == 1 && Model.case_.Change_Id == null)
                            {
                                <!--TODO kontroll av behörighet -->
                                <li><a href="#">@Translation.Get("Skapa ändring", Enums.TranslationSource.TextTranslation)</a></li>
                            }
                            if (Html.MasterModel().CustomerSetting.ModuleOrder == 1 && ((SessionFacade.CurrentUser.OrderPermission > 0 || SessionFacade.CurrentUser.UserGroupId > 2)))
                            {
                                <!--TODO kontroll av att order inte finns -->
                                <li><a href="#">@Translation.Get("Skapa beställning", Enums.TranslationSource.TextTranslation)</a></li>
                            }                                
                        }
                        </ul> 
                    </div>
                </li>
            </ul>
        </div>
        <div class="pull-right">
            <ul class="secnav">
                <li><a href="#" class="btn"><i class="icon-file"></i></a></li>
                <li><a href="#" class="btn"><i class="icon-th-large"></i></a></li>
                <li><a href="#" class="btn"><i class="icon-list"></i></a></li>
                <li><a href="#" class="btn"><i class="icon-chevron-left"></i></a></li>
                <li><a href="#" class="btn"><i class="icon-chevron-right"></i></a></li>
            </ul>
        </div>
    </div>
    <div class="secnavs fixedrow2">
        <div class="pull-left">
            <ul class="secnav">
                <li>
                    <select id="case__RegLanguage_Id" name="case_.RegLanguage_Id" class="span1">
                    @if(Model.languages != null)
                    {
                        foreach(var e in Model.languages)
                        {
                        <option value="@e.Id" @e.Id.IdIsSelected(Model.case_.RegLanguage_Id.ToString()) >@e.LanguageID</option>
                        }
                    }
                    </select>
                </li>
                <li class="secspace"></li>
                <li>
                    <label class="checkbox">
                        @Html.CheckBoxFor(model => model.CaseMailSetting.DontSendMailToNotifier) @Translation.Get("Skicka ej mail till anmälaren", Enums.TranslationSource.TextTranslation)
                    </label>
                </li>
            </ul>
        </div>
    </div>
    @Html.Partial("_Input", Model)
    }
}

