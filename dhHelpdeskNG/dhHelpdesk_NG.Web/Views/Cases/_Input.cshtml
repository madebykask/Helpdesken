@model DH.Helpdesk.Web.Models.Case.CaseInputViewModel 
@using System.Web.Optimization
@using System.Linq;
@using DH.Helpdesk.BusinessData.OldComponents
@using DH.Helpdesk.Common.Enums.Settings
@using DH.Helpdesk.Web.Infrastructure.Extensions
@using DH.Helpdesk.Web.Infrastructure.Extensions.HtmlHelperExtensions

<script type="text/javascript">
    window.parameters = {
        currentCaseId: '@Model.case_.Id',
        productAreaErrorMessage:'@Translation.Get("Ärendet kunde inte sparas då den lägsta möjliga nivån på fält")' + " [" +
                                '@Translation.Get(GlobalEnums.TranslationCaseFields.ProductArea_Id.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id)' + "] " +
                                '@Translation.Get("inte har valts. Vänligen kontrollera ärendet.")',
        caseLockGuid: '@Model.CaseLock.LockGUID',
        userCaseLocker: '@Model.CaseLock.UserId',
        extendValue: '@Model.CaseLock.ExtendValue',
        caseLockChecker: '@Url.Content("~/Cases/IsCaseAvailable/")',
        caseLockExtender: '@Url.Content("~/Cases/ReExtendCaseLock/")',
        saveLockedCaseMessage: '@Translation.Get("Ärendet kunde inte sparas då det är öppet hos en annan användare.")',
        deleteLockedCaseMessage: '@Translation.Get("Ärendet kan inte tas bort då det är öppet hos en annan användare.")',
        moveLockedCaseMessage: '@Translation.Get("Ärendet kan inte flyttas då det är öppet hos en annan användare.")'
    };  

</script>
@Scripts.Render("~/bundles/invoices", "~/bundles/cases/edit")
@{  
    var pDepartmentVisible = false;
    if (Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.Department_Id, CaseSolutionFields.Department) == string.Empty)
    {
        pDepartmentVisible = true;
    }
 }
@if (Model.case_ != null)
{
    <div class="content onemenu editcase" id="mm1">
        <div class="container">
            <ul class="nav nav-tabs" id="myTab">
                <li class="active">
                    @*<a id="case-tab" href="#case" class="case">@Translation.Get("Ärende")
                        @if (Model.case_.Id != 0)
                        {@Model.case_.CaseNumber }
                    </a>*@
                    @if (Model.CaseTemplateName != null)
                    {
                        <a id="case-tab" href="#case" class="case">@Model.CaseTemplateName</a>
                    }
                    else
                    {
                        <a id="case-tab" href="#case" class="case">@Translation.Get("Ärende")
                            @if (Model.case_.Id != 0)
                            {
                                @Model.case_.CaseNumber 
                            }                            
                        </a>
                    }

                </li>

                @if (Model.DynamicCase != null && Model.DynamicCase.ExternalPage)
                {
                    if (!Model.DynamicCase.Modal)
                    {
                    <li>
                        <a href="#dh-form-area" id="loadContainer" class="eform">@(Translation.Get(Model.DynamicCase.FormName))</a>
                    </li>
                    }
                    else
                    {
                    <li class="dh-modal">
                        <a id="openContainer">@(Translation.Get(Model.DynamicCase.FormName))</a>
                    </li>
                    }
                }

                @if (Model.CaseLock != null && Model.CaseLock.IsLocked && Model.CaseLock.User != null)
                {
                    if (Model.CaseLock.UserId == SessionFacade.CurrentUser.Id)
                    {
                        <li class="notice">
                            <a>@Translation.Get("OBS! Du har redan öppnat detta ärende i en annan session.")</a>
                        </li>
                    }
                    else
                    {
                        <li class="notice">
                            <a>@Translation.Get("OBS! Detta ärende är öppnat av")&nbsp; @Model.CaseLock.User.UserID</a>
                        </li>
                    }
                }
            </ul>
            <div class="tab-content">
                <div class="tab-pane tab-pane-border active" id="case">
                    <div class="container">
                        @Html.HiddenFor(model => model.case_.Id, new { data_field = "caseId" })
                        @Html.HiddenFor(model => model.case_.CaseGUID)
                        @Html.HiddenFor(model => model.case_.Customer_Id, new { data_field = "customerId" })
                        @Html.HiddenFor(model => model.case_.User_Id)
                        @Html.HiddenFor(model => model.case_.IpAddress)
                        @Html.HiddenFor(model => model.case_.Deleted)
                        @Html.HiddenFor(model => model.case_.RegistrationSource)
                        @Html.HiddenFor(model => model.DepartmentFilterFormat, new { data_field = "departmentFilterFormat" })
                        @Html.HiddenFor(model => model.case_.RegUserDomain)
                        @Html.HiddenFor(model => model.case_.RegUserId)
                        @Html.HiddenFor(model => model.case_.CaseNumber)
                        @Html.HiddenFor(model => model.case_.ProductAreaSetDate)
                        @Html.HiddenFor(model => model.case_.LockCaseToWorkingGroup_Id)
                        @Html.HiddenFor(model => model.case_.FinishingDate)
                        @Html.HiddenFor(model => model.case_.ProductAreaQuestionVersion_Id)
                        @Html.HiddenFor(model => model.case_.LeadTime)
                        @Html.HiddenFor(model => model.case_.CaseCleanUp_Id)
                        @Html.HiddenFor(model => model.case_.RelatedCaseNumber)
                        @Html.HiddenFor(model => model.case_.ApprovedDate)
                        @Html.HiddenFor(model => model.case_.ApprovedBy_User_Id)
                        @Html.HiddenFor(model => model.case_.ApprovedBy_User_Id)
                        @Html.HiddenFor(model => model.case_.FollowUpDate)
                        @Html.HiddenFor(model => model.case_.ExternalTime)
                        @Html.HiddenFor(model => model.case_.DefaultOwnerWG_Id)
                        @Html.HiddenFor(model => model.CaseKey)
                        @Html.HiddenFor(model => model.CaseMailSetting.SendMailAboutNewCaseTo)
                        @Html.HiddenFor(model => model.CaseMailSetting.HelpdeskMailFromAdress)
                        @Html.HiddenFor(model => model.CaseMailSetting.AbsoluterUrl)
                        @Html.HiddenFor(model => model.CaseMailSetting.DontConnectUserToWorkingGroup, new { data_field = "dontConnectUserToWorkingGroup" })
                        @Html.HiddenFor(model => model.CaseFileNames)
                        @Html.HiddenFor(model => model.LogFileNames)
                        @Html.HiddenFor(model => model.case_.Unread)
                        @Html.HiddenFor(model => model.ProductAreaHasChild)
                        @Html.Hidden("WriteTextToExternalNote", Model.caseFieldSettings.displayHtml(GlobalEnums.TranslationCaseFields.tblLog_Text_External.ToString()))
                        @Html.Hidden("Today", DateTime.Now.ToShortDateString())
                        @Html.Hidden("CurLanguageId", SessionFacade.CurrentLanguageId)
                        @Html.Hidden("SelectedValueCarrier", "")
                        @Html.HiddenFor(model => Model.CaseLock.LockGUID)                        

                        @if (Model.customerUserSetting.UserInfoPermission == 1)
                        {                                                        
                            <div style="@Model.caseFieldSettings.displayUserInfoHtml()"  class="notifier-block hideshow">
                                <h4><a href="#" class="showbtn"><i class="icon-plus-sign"></i></a><a href="#" class="hidebtn"><i class="icon-minus-sign"></i></a> @Translation.Get("Anmälare")</h4>
                                <div class="row">
                                    <div class="span12">
                                        <table class="tableform">
                                            <thead>
                                                <tr>
                                                    <th class="span3"></th>
                                                    <th class="span4"></th>
                                                    <th class="span5"></th>
                                                </tr>
                                            </thead>
                                            <tr style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.ReportedBy, CaseSolutionFields.UserNumber)">
                                                <td>
                                                    @CaseFieldCaption(GlobalEnums.TranslationCaseFields.ReportedBy, "Användar ID")
                                                </td>
                                                <td>
                                                    @Html.Hidden("ShowReportedBy", Model.caseFieldSettings.getCaseSettingsValue(GlobalEnums.TranslationCaseFields.ReportedBy.ToString()).ShowOnStartPage)
                                                    @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.ReportedBy, CaseSolutionFields.UserNumber))
                                                    {
                                                        @Html.TextBoxFor(model => model.case_.ReportedBy, new { maxlength = "40", autocomplete = "Off", data_field = "userId" })
                                                    }
                                                    else
                                                    {
                                                        @Html.TextBoxFor(model => model.case_.ReportedBy, new { maxlength = "40", autocomplete = "Off", @readonly = true, data_field = "userId" })
                                                    }
                                                </td>
                                                <td>
                                                    <a href="#"
                                                       id="AddNotifier"
                                                       style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.AddUserBtn, CaseSolutionFields.AddUserBtn)" 
                                                       class="btn @Model.GetDisabledString(GlobalEnums.TranslationCaseFields.ReportedBy, CaseSolutionFields.UserNumber)">@Translation.Get("Lägg till", SessionFacade.CurrentLanguageId)</a>
                                                    @if (Model.CanGetRelatedCases)
                                                    {
                                                        <a href="#" data-field="relatedCases" style="display: none;" title="@Translation.Get("Relaterade ärenden")" class="btn"><i class="icon-list"></i></a>                                                        
                                                    }
                                                </td>
                                            </tr>
                                            <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.Persons_Name, CaseSolutionFields.PersonsName)">
                                                <td>
                                                    @CaseFieldCaption(GlobalEnums.TranslationCaseFields.Persons_Name, "Anmälare")
                                                </td>
                                                <td>
                                                    @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.Persons_Name, CaseSolutionFields.PersonsName))
                                                    {
                                                        @Html.TextBoxFor(model => model.case_.PersonsName, new { maxlength = "50" })
                                                    }
                                                    else
                                                    {
                                                        @Html.TextBoxFor(model => model.case_.PersonsName, new { maxlength = "50", @readonly = "readonly" })
                                                    }
                                                    
                                                </td>

                                            </tr>
                                            <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.Persons_EMail, CaseSolutionFields.Email)">
                                                <td class="span3">
                                                    @CaseFieldCaption(GlobalEnums.TranslationCaseFields.Persons_EMail, "E-post")
                                                </td>
                                                <td class="span4">
                                                     @if (Model.IsReadOnly(GlobalEnums.TranslationCaseFields.Persons_EMail, CaseSolutionFields.Email))
                                                     {
                                                         @Html.TextBoxFor(model => model.case_.PersonsEmail, new { maxlength = "100", @readonly = "readonly" })
                                                     }
                                                     else
                                                     {
                                                         @Html.TextBoxFor(model => model.case_.PersonsEmail, new { maxlength = "100" })
                                                     }
                                                </td>
                                                <td style="@Model.GetFieldStyle(CaseSolutionFields.Email)">
                                                    <label class="checkbox">
                                                        @if (!Model.IsReadOnly(CaseSolutionFields.Email))
                                                        {
                                                            @Html.CheckBoxFor(model => model.CaseMailSetting.DontSendMailToNotifier) 
                                                        }
                                                        else
                                                        {
                                                            @Html.CheckBoxFor(model => model.CaseMailSetting.DontSendMailToNotifier, new { @readonly = true, @disabled = "disabled" }) 
                                                        }
                                                        @Translation.Get("Skicka mail till anmälaren", SessionFacade.CurrentLanguageId)
                                                    </label>

                                                    @if (Model.Languages != null && Model.Languages.Count() > 1 && Model.case_.Id == 0)
                                                    {
                                                        <select id="case__RegLanguage_Id" name="case_.RegLanguage_Id" class="span2">
                                                            @foreach (var e in Model.Languages)
                                                            {
                                                                <option value="@e.Id" @e.Id.IdIsSelected(SessionFacade.CurrentLanguageId.ToString()) >@Translation.Get(e.Name, SessionFacade.CurrentLanguageId)</option>
                                                            }
                                                        </select>
                                                    }
                                                    else
                                                    {
                                                        if (Model.Languages != null && Model.Languages.Count() > 1 && !Model.IsReadOnly(CaseSolutionFields.Email))
                                                        {                                            
                                                        <select id="case__RegLanguage_Id" name="case_.RegLanguage_Id" class="span2">
                                                            @foreach (var e in Model.Languages)
                                                            {
                                                                <option value="@e.Id" @e.Id.IdIsSelected(Model.case_.RegLanguage_Id.ToString()) >@Translation.Get(e.Name, SessionFacade.CurrentLanguageId)</option>
                                                            }
                                                        </select>                                                                                                                                                                            
                                                        }
                                                        else
                                                        {
                                                            @Html.HiddenFor(m => Model.case_.RegLanguage_Id);
                                                        }
                                                    }
                                                </td>
                                            </tr>
                                            <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.Persons_Phone, CaseSolutionFields.PersonsPhone)">
                                                <td class="span3">
                                                    @CaseFieldCaption(GlobalEnums.TranslationCaseFields.Persons_Phone, "Telefon")
                                                </td>
                                                <td class="span4">
                                                    @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.Persons_Phone, CaseSolutionFields.PersonsPhone))
                                                    {
                                                        @Html.TextBoxFor(model => model.case_.PersonsPhone, new { maxlength = "40" })
                                                    }
                                                    else
                                                    {
                                                       @Html.TextBoxFor(model => model.case_.PersonsPhone, new { maxlength = "40", @readonly = "readonly" })
                                                    }
                                                </td>
                                            </tr>
                                            <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.Persons_CellPhone, CaseSolutionFields.PersonsCellPhone)">
                                                <td class="span3">
                                                    @CaseFieldCaption(GlobalEnums.TranslationCaseFields.Persons_CellPhone, "Mobil")
                                                </td>
                                                <td class="span4">
                                                    @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.Persons_CellPhone, CaseSolutionFields.PersonsCellPhone))
                                                    {
                                                        @Html.TextBoxFor(model => model.case_.PersonsCellphone, new { maxlength = "30" })
                                                    }
                                                    else
                                                    {
                                                        @Html.TextBoxFor(model => model.case_.PersonsCellphone, new { maxlength = "30", @readonly = "readonly" })
                                                    }
                                                </td>
                                            </tr>
                                            <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.Region_Id, CaseSolutionFields.Region)">
                                                <td class="span3">
                                                    @CaseFieldCaption(GlobalEnums.TranslationCaseFields.Region_Id, "Område")
                                                </td>
                                                <td class="span4">
                                                    @if (Model.IsReadOnly(GlobalEnums.TranslationCaseFields.Region_Id, CaseSolutionFields.Region))
                                                    {
                                                        var curRegion = Model.regions.Where(r => r.Id == Model.case_.Region_Id).SingleOrDefault();
                                                        @Html.TextBoxFor(m => curRegion.Name, new { id = "RegionName", @readonly = true })
                                                        @Html.HiddenFor(m => Model.case_.Region_Id)
                                                    }
                                                    else
                                                    {
                                                         <select id="case__Region_Id" name="case_.Region_Id" data-field="region">
                                                            <option value="">&nbsp;</option>                                                            
                                                            @if (Model.regions != null)
                                                            {
                                                                foreach (var e in Model.regions.Where(e => e.IsActive == 1 || Model.case_.Region_Id == e.Id))
                                                                {
                                                                    <option value="@e.Id" @e.Id.IdIsSelected(Model.case_.Region_Id.ToString()) >@e.Name</option>
                                                                }
                                                            }
                                                        </select>
                                                    }                                                                                                             
                                                </td>
                                            </tr>
                                            <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.Department_Id, CaseSolutionFields.Department)">
                                                <td class="span3">
                                                    @CaseFieldCaption(GlobalEnums.TranslationCaseFields.Department_Id, "Avdelning")
                                                </td>
                                                <td class="span4">
                                                        
                                                        @if (Model.IsReadOnly(GlobalEnums.TranslationCaseFields.Department_Id, CaseSolutionFields.Department))
                                                        {
                                                            var curDep = Model.departments.Where(d => d.Id == Model.case_.Department_Id).SingleOrDefault();
                                                            @Html.TextBoxFor(m => curDep.DepartmentName, new { id = "DepartmentName", @readonly = true })
                                                            @Html.HiddenFor(m => Model.case_.Department_Id) 
                                                        }
                                                        else
                                                        {                                                        
                                                            <select id="case__Department_Id" name="case_.Department_Id" data-field="department">
                                                                <option value="">&nbsp;</option>
                                                                @if (Model.departments != null)
                                                                {
                                                                    foreach (var e in Model.departments.Where(e => e.IsActive == 1 || Model.case_.Department_Id == e.Id).Where(e => Model.case_.Region_Id == e.Region_Id || !Model.case_.Region_Id.IntHasValue()))
                                                                    {
                                                                    <option value="@e.Id" @e.Id.IdIsSelected(Model.case_.Department_Id.ToString())>@e.DepartmentDescription(Model.DepartmentFilterFormat)</option>
                                                                    }
                                                                }
                                                            </select>
                                                        }
                                                </td>
                                            </tr>
                                            <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.OU_Id, CaseSolutionFields.OU)">
                                                <td class="span3">
                                                    @CaseFieldCaption(GlobalEnums.TranslationCaseFields.OU_Id, "Enhet")
                                                </td>
                                                <td class="span4">
                                                        @if (Model.IsReadOnly(GlobalEnums.TranslationCaseFields.OU_Id, CaseSolutionFields.OU))
                                                        {                                                                                                                        
                                                            @Html.TextBox("OUName", Model.ous.Where(w => w.Id == Model.case_.OU_Id).Select(o => o.Name).SingleOrDefault(), new { id = "OuName", @readonly = true })
                                                            @Html.HiddenFor(m => Model.case_.OU_Id, new { id = "case__Ou_Id", name = "case_.OU_Id" })                                                              
                                                        }
                                                        else
                                                        {
                                                            <select id="case__Ou_Id" name="case_.OU_Id" data-field="ou">
                                                                <option value="">&nbsp;</option>
                                                                @if (Model.ous != null)
                                                                {
                                                                    foreach (var ou in Model.ous)
                                                                    {                                                                
                                                                        <option value="@ou.Id" @ou.Id.IdIsSelected(Model.case_.OU_Id.ToString()) >@ou.Name</option>
                                                                    }
                                                                }
                                                            </select>
                                                        }                                    
                                                </td>                                                
                                            </tr>
                                            <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.Place, CaseSolutionFields.Place)">
                                                <td class="span3">
                                                    @CaseFieldCaption(GlobalEnums.TranslationCaseFields.Place, "Placering")
                                                </td>
                                                <td class="span4">
                                                    @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.Place, CaseSolutionFields.Place))
                                                    {
                                                        @Html.TextBoxFor(model => model.case_.Place, new { maxlength = "100" })
                                                    }
                                                    else
                                                    {
                                                        @Html.TextBoxFor(model => model.case_.Place, new { maxlength = "100", @readonly = "readonly" })
                                                    }
                                                </td>
                                            </tr>
                                            <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.UserCode, CaseSolutionFields.Usercode)">
                                                <td class="span3">
                                                    @CaseFieldCaption(GlobalEnums.TranslationCaseFields.UserCode, "Ansvarskod")
                                                </td>
                                                <td class="span4">
                                                    
                                                    @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.UserCode, CaseSolutionFields.Usercode))
                                                    {
                                                        @Html.TextBoxFor(model => model.case_.UserCode, new { maxlength = "20" })
                                                    }
                                                    else
                                                    {
                                                        @Html.TextBoxFor(model => model.case_.UserCode, new { maxlength = "20", @readonly = "readonly" })
                                                    }
                                                </td>
                                            </tr>
@*                                            Save user info checkbox*@
                                            <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.UpdateNotifierInformation, CaseSolutionFields.UpdateNotifierInformation)">
                                                <td class="span3">
                                                    @Translation.Get("Spara användaruppgifter", SessionFacade.CurrentLanguageId)
                                                </td>
                                                <td class="span4">
                                                    @if (Model.IsReadOnly(CaseSolutionFields.UpdateNotifierInformation))
                                                    {
                                                        @Html.CheckBoxFor(m => Model.UpdateNotifierInformation, new { @class = "switchcheckbox", @readonly = "readonly" });
                                                    }
                                                    else
                                                    {
                                                        @Html.CheckBoxFor(m => Model.UpdateNotifierInformation, new { @class = "switchcheckbox" }) 
                                                    }                                
                                                    
                                                 </td>   
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        }
                        else
                        {
                            @Html.HiddenFor(m => Model.case_.RegLanguage_Id);
                        }
                        <div style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.InventoryNumber, CaseSolutionFields.InventoryNumber)"  class="computer-block hideshow">
                            <h4><a href="#" class="showbtn"><i class="icon-plus-sign"></i></a><a href="#" class="hidebtn"><i class="icon-minus-sign"></i></a> @Translation.Get("Datorinformation")</h4>
                            <div class="row">
                                <div class="span12">
                                    <table class="tableform">
                                        <thead>
                                            <tr>
                                                <th class="span3"></th>
                                                <th class="span4"></th>
                                                <th class="span5"></th>
                                            </tr>
                                        </thead>
                                        <tr style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.InventoryNumber, CaseSolutionFields.InventoryNumber)">
                                            <td>
                                                @CaseFieldCaption(GlobalEnums.TranslationCaseFields.InventoryNumber, "PC Nummer")
                                            </td>
                                            <td>
                                                @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.InventoryNumber, CaseSolutionFields.InventoryNumber))
                                                {
                                                        @Html.TextBoxFor(model => model.case_.InventoryNumber, new { maxlength = "20", autocomplete = "Off" })
                                                }
                                                else
                                                {
                                                        @Html.TextBoxFor(model => model.case_.InventoryNumber, new { maxlength = "20", @readonly = "readonly" })
                                                }
                                            </td>
                                            <td></td>
                                        </tr>
                                        <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.ComputerType_Id, CaseSolutionFields.InventoryType)">
                                            <td class="span3">
                                                @CaseFieldCaption(GlobalEnums.TranslationCaseFields.ComputerType_Id, "Datortyp")
                                            </td>
                                            <td class="span4">
                                                 @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.ComputerType_Id, CaseSolutionFields.InventoryType))
                                                 {
                                                        @Html.TextBoxFor(model => model.case_.InventoryType, new { maxlength = "50" })
                                                 }
                                                 else
                                                 {
                                                        @Html.TextBoxFor(model => model.case_.InventoryType, new { maxlength = "50", @readonly = "readonly" })
                                                 }
                                            </td>
                                        </tr>
                                        <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.InventoryLocation, CaseSolutionFields.InventoryLocation)">
                                            <td class="span3">
                                                @CaseFieldCaption(GlobalEnums.TranslationCaseFields.InventoryLocation, "Placering")
                                            </td>
                                            <td class="span4">
                                                @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.InventoryLocation, CaseSolutionFields.InventoryLocation))
                                                {
                                                        @Html.TextBoxFor(model => model.case_.InventoryLocation, new { maxlength = "100" })
                                                }
                                                else
                                                {
                                                        @Html.TextBoxFor(model => model.case_.InventoryLocation, new { maxlength = "100", @readonly = "readonly" })
                                                }
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    <div class="caseinfo-block hideshow">
                        <h4><a href="#" class="showbtn"><i class="icon-plus-sign"></i></a><a href="#" class="hidebtn"><i class="icon-minus-sign"></i></a> @Translation.Get("Ärendeinformation")</h4>
                        <div class="row">
                            <div class="span12">
                                <table class="tableform">
                                    <thead>
                                        <tr>
                                            <th class="span3"></th>
                                            <th class="span4"></th>
                                            <th class="span5"></th>
                                        </tr>
                                    </thead>
                                    @if (Model.case_.Id != 0)
                                    {
                                        <tr class="displaytr" style="@Model.caseFieldSettings.displayHtml(GlobalEnums.TranslationCaseFields.CaseNumber.ToString())">
                                            <td>
                                                @CaseFieldCaption(GlobalEnums.TranslationCaseFields.CaseNumber, "Ärende")
                                            </td>
                                            <td>
                                                @Model.case_.CaseNumber
                                            </td>
                                            <td></td>
                                        </tr>                                        
                                        <tr class="displaytr">
                                            <td>
                                                @Translation.Get("Registreringsdatum")
                                            </td>
                                            <td colspan="2">
                                                @Html.DisplayFor(m => m.case_.RegTime, "DateAndTime")
                                            </td>
                                        </tr>                                             
                                        <tr style="@Model.caseFieldSettings.displayHtml(GlobalEnums.TranslationCaseFields.User_Id.ToString())">
                                            <td>
                                                @CaseFieldCaption(GlobalEnums.TranslationCaseFields.User_Id, "Registrerad av")
                                            </td>
                                            <td>
                                                @if (Model.RegByUser != null)
                                                {    
                                                    <span>@Model.RegByUser.FirstName @Model.RegByUser.SurName</span>
                                                    if (Model.CaseOwnerDefaultWorkingGroup != null)
                                                    {
                                                    <span>&nbsp;-&nbsp;@Model.CaseOwnerDefaultWorkingGroup.WorkingGroupName</span>
                                                    }
                                                }
                                                @if (!string.IsNullOrEmpty(Model.case_.RegUserId))
                                                {
                                                    <span>&nbsp;(@Model.case_.RegUserId)</span>
                                                }
                                                <span>&nbsp;(@Model.case_.IpAddress)</span>
                                            </td>
                                            <td></td>
                                        </tr>                                        
                                    }
                                    @*                      "CustomerRegistrationSource" field               *@
                                    <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.RegistrationSourceCustomer, CaseSolutionFields.RegistrationSourceCustomer)">
                                        <td class="span3">
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.RegistrationSourceCustomer, "Källa")
                                        </td>
                                        <td class="span4">
                                            @Html.DropDownListFor(m => m.CustomerRegistrationSourceId, Model.CustomerRegistrationSources, @Model.IsReadOnly(GlobalEnums.TranslationCaseFields.RegistrationSourceCustomer, CaseSolutionFields.RegistrationSourceCustomer) ? new { @disabled = true } : null)
                                        </td>
                                    </tr>
                                    <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.CaseType_Id, CaseSolutionFields.CaseType)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.CaseType_Id, "Ärendetyp")
                                        </td>
                                        <td colspan="2">
                                            <div id="divCaseType" class="btn-group">
                                                @{
                                    string disabledCaseType = Model.GetDisabledString(GlobalEnums.TranslationCaseFields.CaseType_Id, CaseSolutionFields.CaseType);
                                                }
                                                <div class="btn @disabledCaseType" id="divBreadcrumbs_CaseType">@Model.ParantPath_CaseType</div>
                                                <button class="btn dropdown-toggle" data-toggle="dropdown" @disabledCaseType>
                                                    <span class="caret"></span>
                                                </button>
                                                <ul class="dropdown-menu">
                                                    <li><a href="#">@Translation.Get("--")</a></li>
                                                    @Html.CaseTypeDropdownButtonString(Model.caseTypes)
                                                </ul>

                                                <input type="hidden" id="case__CaseType_Id" name="case_.CaseType_Id" value="@Model.case_.CaseType_Id.supressZero()" />
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.ProductArea_Id, CaseSolutionFields.ProductArea)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.ProductArea_Id, "Produktområde")
                                        </td>
                                        <td colspan="2">
                                            <div id="divProductArea" class="btn-group">
                                                @{
                                    string disabledProductArea = Model.GetDisabledString(GlobalEnums.TranslationCaseFields.ProductArea_Id, CaseSolutionFields.ProductArea);
                                                }
                                                <div class="btn @disabledProductArea" id="divBreadcrumbs_ProductArea">@Model.ParantPath_ProductArea</div>
                                                <button class="btn dropdown-toggle" data-toggle="dropdown" @disabledProductArea>
                                                    <span class="caret"></span>
                                                </button>
                                                <ul class="dropdown-menu">
                                                    <li><a href="#">@Translation.Get("--")</a></li>
                                                    @Html.ProductAreaDropdownButtonString(Model.productAreas)
                                                </ul>
                                                @Html.HiddenFor(model => model.case_.ProductArea_Id, new { @class = "product-area-id" })
                                            </div>
                                            @if (Model.CustomerSettings.ModuleCaseInvoice)
                                            {
                                                  @Html.CaseInvoiceArticles(
                                                    Model.InvoiceArticles,
                                                    "product-area-id",
                                                    Model.case_.Id,
                                                    "case-invoice-articles",
                                                    Model.case_.Customer_Id,
                                                    Translation.Get("Skicka till fakturering"),
                                                    Translation.Get("Artiklar att fakturera"),
                                                    Model.CaseKey)
                                                @Html.HiddenFor(m => m.CaseInvoiceArticles, new { @class = "case-invoice-articles" })                                                                                            
                                            }
                                        </td>
                                    </tr>
                                    <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.System_Id, CaseSolutionFields.System)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.System_Id, "System")
                                        </td>
                                        <td colspan="2">
                                             @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.System_Id, CaseSolutionFields.System))
                                             {
                                                        <select id="case__System_Id" name="case_.System_Id">
                                                            <option value="">&nbsp;</option>
                                                            @if (Model.systems != null)
                                                            {
                                                                foreach (var e in Model.systems)
                                                                {
                                                                <option value="@e.Id" @e.Id.IdIsSelected(Model.case_.System_Id.ToString()) >@e.SystemName</option>
                                                                }
                                                            }
                                                        </select>
                                             }
                                             else
                                             {
                                                 if (!Model.case_.System_Id.HasValue)
                                                 {
                                                            @Html.TextBoxFor(m => m.case_.System_Id, new { @readonly = true })
                                                 }
                                                 else
                                                 {
                                                            @Html.TextBoxFor(m => m.systems.SingleOrDefault(x => x.Id == Model.case_.System_Id).SystemName, new { @readonly = true })
                                                            @Html.HiddenFor(x => x.case_.System_Id)
                                                 }
                                             }
                                        </td>
                                    </tr>
                                    <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.Urgency_Id, CaseSolutionFields.Urgency)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.Urgency_Id, "Brådskandegrad")
                                        </td>
                                        <td colspan="2">
                                             @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.Urgency_Id, CaseSolutionFields.Urgency))
                                             {
                                                <select id="case__Urgency_Id" name="case_.Urgency_Id">
                                                    <option value="">&nbsp;</option>
                                                    @if (Model.urgencies != null)
                                                    {
                                                        foreach (var e in Model.urgencies)
                                                        {
                                                        <option value="@e.Id" @e.Id.IdIsSelected(Model.case_.Urgency_Id.ToString()) >@e.Name</option>
                                                        }
                                                    }
                                                </select>
                                             }
                                             else
                                             {
                                                 if (!Model.case_.Urgency_Id.HasValue)
                                                 {
                                                            @Html.TextBoxFor(m => m.case_.Urgency_Id, new { @readonly = true })
                                                 }
                                                 else
                                                 {
                                                            @Html.TextBoxFor(m => m.urgencies.SingleOrDefault(x => x.Id == Model.case_.Urgency_Id).Name, new { @readonly = true })
                                                            @Html.HiddenFor(x => x.case_.Urgency_Id)
                                                 }
                                             }
                                        </td>
                                    </tr>
                                    <tr class="displaytr"  style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.Impact_Id, CaseSolutionFields.Impact)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.Impact_Id, "Påverkan")
                                        </td>
                                        <td colspan="2">
                                            @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.Impact_Id, CaseSolutionFields.Impact))
                                            {
                                                <select id="case__Impact_Id" name="case_.Impact_Id">
                                                    <option value="">&nbsp;</option>
                                                    @if (Model.impacts != null)
                                                    {
                                                        foreach (var e in Model.impacts)
                                                        {
                                                        <option value="@e.Id" @e.Id.IdIsSelected(Model.case_.Impact_Id.ToString()) >@e.Name</option>
                                                        }
                                                    }
                                                </select>
                                            }
                                            else
                                            {
                                                if (!Model.case_.Impact_Id.HasValue)
                                                {
                                                            @Html.TextBoxFor(m => m.case_.Impact_Id, new { @readonly = true })
                                                }
                                                else
                                                {
                                                            @Html.TextBoxFor(m => m.impacts.SingleOrDefault(x => x.Id == Model.case_.Impact_Id).Name, new { @readonly = true })
                                                            @Html.HiddenFor(x => x.case_.Impact_Id)
                                                }
                                            }
                                        </td>
                                    </tr>
                                    <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.Category_Id, CaseSolutionFields.Category)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.Category_Id, "Kategori")
                                        </td>
                                        <td colspan="2">
                                            @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.Category_Id, CaseSolutionFields.Category))
                                            {

                                                <select id="case__Category_Id" name="case_.Category_Id">
                                                    <option value="">&nbsp;</option>
                                                    @if (Model.categories != null)
                                                    {
                                                        foreach (var e in Model.categories.Where(e => e.IsActive == 1 || Model.case_.Category_Id == e.Id))
                                                        {
                                                        <option value="@e.Id" @e.Id.IdIsSelected(Model.case_.Category_Id.ToString()) >@e.Name</option>
                                                        }
                                                    }
                                                </select>
                                            }
                                            else
                                            {
                                                if (!Model.case_.Category_Id.HasValue)
                                                {
                                                @Html.TextBoxFor(m => m.case_.Category_Id, new { @readonly = true })
                                                }
                                                else
                                                {
                                                @Html.TextBoxFor(m => m.categories.SingleOrDefault(x => x.Id == Model.case_.Category_Id).Name, new { @readonly = true })
                                                @Html.HiddenFor(x => x.case_.Category_Id)
                                                }
                                            }
                                        </td>
                                    </tr>
                                    <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.Supplier_Id, CaseSolutionFields.Supplier)">
                                        <td>
                                            @if (Model.countries != null)
                                            {
                                                @Translation.Get("Land")<span>/</span>
                                            }
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.Supplier_Id, "Leverantör")
                                        </td>
                                        @if (Model.countries != null)
                                        {
                                            <td>
                                                <select id="CountryId" name="CountryId" @(Model.EditMode == Enums.AccessMode.ReadOnly ? "disabled=true" : string.Empty)>
                                                    <option value="">&nbsp;</option>
                                                    @foreach (var e in Model.countries.Where(e => e.IsActive == 1 || Model.CountryId == e.Id))
                                                    {
                                                        <option value="@e.Id" @e.Id.IdIsSelected(Model.CountryId.ToString()) >@e.Name</option>
                                                    }
                                                </select>
                                            </td>
                                        }
                                        <td style="float: left;">
                                            @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.Supplier_Id, CaseSolutionFields.Supplier))
                                            {
                                                <select id="case__Supplier_Id" name="case_.Supplier_Id">
                                                    <option value="">&nbsp;</option>
                                                    @if (Model.suppliers != null)
                                                    {
                                                        foreach (var e in Model.suppliers.Where(e => e.IsActive == 1 || Model.case_.Supplier_Id == e.Id).Where(e => Model.CountryId.IntHasValue() && (e.Country_Id == Model.CountryId && e.Country_Id.HasValue)))
                                                        {
                                                        <option value="@e.Id" @e.Id.IdIsSelected(Model.case_.Supplier_Id.ToString()) >@e.Name</option>
                                                        }
                                                    }
                                                </select>
                                            }
                                            else
                                            {
                                                if (!Model.case_.Supplier_Id.HasValue)
                                                {
                                                @Html.TextBoxFor(m => m.case_.Supplier_Id, new { @readonly = true })
                                                }
                                                else
                                                {
                                                @Html.TextBoxFor(m => m.suppliers.SingleOrDefault(x => x.Id == Model.case_.Supplier_Id).Name, new { @readonly = true })
                                                @Html.HiddenFor(x => x.case_.Supplier_Id)
                                                }
                                            }
                                        </td>
                                    </tr>
                                    <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.InvoiceNumber, CaseSolutionFields.InvoiceNumber)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.InvoiceNumber, "Fakturanummer")
                                        </td>
                                        <td colspan="2">
                                             @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.InvoiceNumber, CaseSolutionFields.InvoiceNumber))
                                             {
                                                        @Html.TextBoxFor(model => model.case_.InvoiceNumber, new { maxlength = "50" })
                                             }
                                             else
                                             {
                                                        @Html.TextBoxFor(model => model.case_.InvoiceNumber, new { maxlength = "50", @readonly = "readonly" })
                                             }
                                        </td>
                                    </tr>
                                    <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.ReferenceNumber, CaseSolutionFields.ReferenceNumber)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.ReferenceNumber, "Referensnummer")
                                        </td>
                                        <td colspan="2">
                                            @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.ReferenceNumber, CaseSolutionFields.ReferenceNumber))
                                            {
                                                        @Html.TextBoxFor(model => model.case_.ReferenceNumber, new { maxlength = "200" })
                                            }
                                            else
                                            {
                                                        @Html.TextBoxFor(model => model.case_.ReferenceNumber, new { maxlength = "200", @readonly = "readonly" })
                                            }
                                        </td>
                                    </tr>
                                    <tr style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.Caption, CaseSolutionFields.Caption)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.Caption, "Rubrik")
                                        </td>
                                        <td colspan="2">
                                            @if ((Model.customerUserSetting.CaptionPermission == 1 && !Model.IsReadOnly(GlobalEnums.TranslationCaseFields.Caption, CaseSolutionFields.Caption)
                                                || Model.case_.Id == 0))
                                            {                                                
                                                @Html.TextBoxFor(model => model.case_.Caption, new { maxlength = "60", @class = "width90" })
                                            }
                                            else
                                            {                                            
                                                @Html.TextBoxFor(model => model.case_.Caption, new { maxlength = "60", @readonly = "readonly", @class = "width90" })
                                            }
                                        </td>
                                    </tr>
                                    <tr style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.Description, CaseSolutionFields.Description)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.Description, "Beskrivning")
                                        </td>
                                        <td colspan="3">

                                            @{
                                            var descriptionSize = Model.caseFieldSettings.getFieldSize(GlobalEnums.TranslationCaseFields.Description.ToString());
                                            if (descriptionSize == 0)
                                            {
                                                descriptionSize = 5;
                                            }
                                            }

                                            @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.Description, CaseSolutionFields.Description))
                                            {
                                                @Html.TextAreaFor(model => model.case_.Description, new { rows = descriptionSize, @class = "case-description width90" })
                                            }
                                            else
                                            {
                                                @Html.TextAreaFor(model => model.case_.Description, new { rows = descriptionSize, @class = "case-description width90", @readonly = true })
                                            }
                                            <span id="caseDescriptionPreview" 
                                                  rel="tooltip" 
                                                  class="icon-circle-arrow-up cursor-pointer" 
                                                  title="@Translation.Get("Förhandsgranska")"
                                                  style="@(string.IsNullOrEmpty(Model.case_.Description) ? "visibility: hidden" : "")"
                                                ></span>

                                        </td>


                                    </tr>
                                    <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.Miscellaneous, CaseSolutionFields.Miscellaneous)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.Miscellaneous, "Övrigt")
                                        </td>
                                        <td colspan="2">
                                            @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.Miscellaneous, CaseSolutionFields.Miscellaneous))
                                            {
                                                @Html.TextAreaFor(model => model.case_.Miscellaneous, new { maxlength = "1000" })
                                            }
                                            else
                                            {
                                                @Html.TextAreaFor(model => model.case_.Miscellaneous, new { maxlength = "1000", @readonly = true })
                                            }
                                        </td>
                                    </tr>
                                    <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.ContactBeforeAction, CaseSolutionFields.ContactBeforeAction)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.ContactBeforeAction, "Telefonkontakt")
                                        </td>
                                        <td colspan="2">
                                            @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.ContactBeforeAction, CaseSolutionFields.ContactBeforeAction))
                                            {
                                                if (Model.customerUserSetting.ContactBeforeActionPermission == 1 || Model.case_.Id == 0)
                                                {
                                                    <input type="checkbox" name="case_.ContactBeforeAction" @(Model.case_.ContactBeforeAction == 1 ? "checked=checked" : "") value="1" class="switchcheckbox" />
                                                    <input type="hidden" name="case_.ContactBeforeAction" value="0" />
                                                }
                                                else
                                                {
                                                    @Model.case_.ContactBeforeAction.IntToYES_NO()
                                                    @Html.HiddenFor(model => model.case_.ContactBeforeAction)
                                                }
                                            }
                                            else
                                            {
                                                <input type="checkbox" name="case_.ContactBeforeAction" value="@Model.case_.ContactBeforeAction" class="switchcheckbox" disabled="disabled" />
                                            }
                                        </td>
                                    </tr>
                                    <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.SMS, CaseSolutionFields.SMS)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.SMS, "SMS")
                                        </td>
                                        <td colspan="2">
                                            @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.SMS, CaseSolutionFields.SMS))
                                            {
                                                <input type="checkbox" name="case_.SMS" @(Model.case_.SMS == 1 ? "checked=checked" : "") value="1"/>
                                            }
                                            else
                                            {
                                                <input type="checkbox" name="case_.SMS" @(Model.case_.SMS == 1 ? "checked=checked" : "") value="1" disabled="disabled"/>
                                            }
                                            <input type="hidden" name="case_.SMS" value="0" />
                                            <span class="lbl">@Translation.Get("Skicka SMS när ärendet avslutas", SessionFacade.CurrentLanguageId).</span>
                                        </td>
                                    </tr>
                                    <tr class="displaytr" style="@Model.caseFieldSettings.displayHtml(GlobalEnums.TranslationCaseFields.AgreedDate.ToString())">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.AgreedDate, "Överenskommet datum")
                                        </td>
                                        <td colspan="2">
                                            @if (Model.EditMode == Enums.AccessMode.ReadOnly)
                                            {
                                                @Html.EditorFor(m => m.case_.AgreedDate, "DatePicker", new { id = "divCase__AgreedDate", disabled = "disabled" })
                                            }
                                            else
                                            {
                                                @Html.EditorFor(m => m.case_.AgreedDate, "DatePicker", new { id = "divCase__AgreedDate" })
                                            }
                                        </td>
                                    </tr>
                                    <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.Available, CaseSolutionFields.Available)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.Available, "Anträffbar")
                                        </td>
                                        <td colspan="2">
                                            @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.Available, CaseSolutionFields.Available))
                                            {
                                                        @Html.TextBoxFor(model => model.case_.Available, new { maxlength = "100" })
                                            }
                                            else
                                            {
                                                        @Html.TextBoxFor(model => model.case_.Available, new { maxlength = "100", @readonly = "readonly" })
                                            }
                                        </td>
                                    </tr>
                                    <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.Cost, CaseSolutionFields.Cost)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.Cost, "Kostnad")
                                        </td>
                                        <td colspan="2">
                                            <table>
                                                <tr>
                                                    @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.Cost, CaseSolutionFields.Cost))
                                                    {
                                                        <td>@Translation.Get("Artikelkostnad", SessionFacade.CurrentLanguageId)<br />
                                                            @Html.TextBoxFor(model => model.case_.Cost, new { maxlength = "7", Class = "inputw50", @readonly = "readonly" })
                                                        </td>
                                                        <td>@Translation.Get("Övrig kostnad", SessionFacade.CurrentLanguageId)<br />
                                                            @Html.TextBoxFor(model => model.case_.OtherCost, new { maxlength = "7", Class = "inputw50", @readonly = "readonly" })
                                                        </td>
                                                        <td>@Translation.Get("Valuta", SessionFacade.CurrentLanguageId)<br />
                                                            <select id="case__Currency" name="case_.Currency" class="inputw100">
                                                                <option value="">&nbsp;</option>
                                                                @if (Model.currencies != null)
                                                                {
                                                                    foreach (var e in Model.currencies)
                                                                    {
                                                                    <option value="@e.Code" @e.Code.ValueIsSelected(Model.case_.Currency) >@e.Code</option>
                                                                    }
                                                                }
                                                            </select>
                                                        </td>
                                                    }
                                                    else
                                                    {
                                                        <td>@Translation.Get("Artikelkostnad", SessionFacade.CurrentLanguageId)<br />
                                                            @Html.TextBoxFor(model => model.case_.Cost, new { maxlength = "7", Class = "inputw50", @readonly = true })
                                                        </td>
                                                        <td>@Translation.Get("Övrig kostnad", SessionFacade.CurrentLanguageId)<br />
                                                            @Html.TextBoxFor(model => model.case_.OtherCost, new { maxlength = "7", Class = "inputw50", @readonly = true })
                                                        </td>
                                                        <td>@Translation.Get("Valuta", SessionFacade.CurrentLanguageId)<br />
                                                           @Html.TextBoxFor(m => m.case_.Currency, new { @readonly = true, Class = "inputw50" })
                                                            @Html.HiddenFor(x => x.case_.Currency)
                                                        </td>
                                                    }
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                    <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.Filename, CaseSolutionFields.FileName)">
                                    @*<tr class="displaytr" style="@Model.caseFieldSettings.displayHtml(GlobalEnums.TranslationCaseFields.Filename.ToString())">*@
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.Filename, "Bifogad fil")
                                        </td>
                                        <td colspan="2">
                                            @if (Model.EditMode == Enums.AccessMode.FullAccess)
                                            {
                                                <a href="#upload_files_popup" role="button" class="btn" data-toggle="modal">@Translation.Get("Lägg till", SessionFacade.CurrentLanguageId)</a>
                                            }
                                            <div id="divCaseFiles">                                                
                                                @Html.Partial("_CaseFiles", Model.CaseFilesModel, new ViewDataDictionary { { "CaseInactive", Model.case_.FinishingDate.HasValue } })
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="displaytr">
                                        <td colspan="3" class="span3"></td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="casehandling-block hideshow">
                        <h4><a href="#" class="showbtn"><i class="icon-plus-sign"></i></a><a href="#" class="hidebtn"><i class="icon-minus-sign"></i></a> @Translation.Get("Ärendehantering")</h4>
                        <div class="row">
                            <div class="span12">
                                <table class="tableform">
                                    <thead>
                                        <tr>
                                            <th class="span3"></th>
                                            <th class="span4"></th>
                                            <th class="span5"></th>
                                        </tr>
                                    </thead>
                                    <tr style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.WorkingGroup_Id, CaseSolutionFields.WorkingGroup)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.WorkingGroup_Id, "Driftgrupp")
                                        </td>
                                        <td>
                                            @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.WorkingGroup_Id, CaseSolutionFields.WorkingGroup))
                                            {
                                                <select id="case__WorkingGroup_Id" name="case_.WorkingGroup_Id" data-field="workingGroup">
                                                    <option value="">&nbsp;</option>
                                                    @if (Model.workingGroups != null)
                                                    {
                                                        foreach (var e in Model.workingGroups.Where(e => e.IsActive == 1 || Model.case_.WorkingGroup_Id == e.Id))
                                                        {
                                                        <option value="@e.Id" @e.Id.IdIsSelected(Model.case_.WorkingGroup_Id.ToString()) >@e.WorkingGroupName</option>
                                                        }
                                                    }
                                                </select>
                                            }
                                            else
                                            {
                                                if (!Model.case_.WorkingGroup_Id.HasValue)
                                                {
                                                @Html.TextBoxFor(m => m.case_.WorkingGroup_Id, new { @readonly = true })
                                                }
                                                else
                                                {
                                                @Html.TextBoxFor(m => m.workingGroups.SingleOrDefault(x => x.Id == Model.case_.WorkingGroup_Id).WorkingGroupName, new { @readonly = true })
                                                @Html.HiddenFor(x => x.case_.WorkingGroup_Id)
                                                }
                                            }
                                        </td>
                                    </tr>
                                    <tr class="displaytr" style="@Model.caseFieldSettings.displayHtml(GlobalEnums.TranslationCaseFields.CaseResponsibleUser_Id.ToString())">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.CaseResponsibleUser_Id, "Ansvarig")
                                        </td>
                                         <td>
                                            @if (Model.EditMode != Enums.AccessMode.ReadOnly)
                                            {
                                                @Html.DropDownListFor(m => m.ResponsibleUser_Id, Model.ResponsibleUsersAvailable)
                                            }
                                            else
                                            {
                                                @Html.DropDownListFor(m => m.ResponsibleUser_Id, Model.ResponsibleUsersAvailable, new { disabled="disabled" })
                                            }
                                        </td>
                                    </tr>
                                    <tr style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.Performer_User_Id, CaseSolutionFields.Administrator)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.Performer_User_Id, "Handläggare")
                                        </td>
                                        <td>
                                            @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.Performer_User_Id, CaseSolutionFields.Administrator))
                                            {
                                                @Html.DropDownListFor(m => m.Performer_Id, Model.Performers, new { data_field = "administrator" })
                                            }
                                            else
                                            {
                                                @Html.DropDownListFor(m => m.Performer_Id, Model.Performers, new { data_field = "administrator", disabled = "disabled" })
                                            }
                                        </td>
                                    </tr>
                                    <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.Priority_Id, CaseSolutionFields.Priority)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.Priority_Id, "Prioritet")
                                        </td>
                                        <td>
                                            @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.Priority_Id, CaseSolutionFields.Priority))
                                            {
                                                <select id="case__Priority_Id" @Model.case_.Id.HtmlReadOnlyFlag(Model.customerUserSetting.PriorityPermission) name="case_.Priority_Id">
                                                    <option value="">&nbsp;</option>
                                                    @if (Model.priorities != null)
                                                    {
                                                        foreach (var e in Model.priorities.Where(e => e.IsActive == 1 || Model.case_.Priority_Id == e.Id))
                                                        {
                                                            <option value="@e.Id" @e.Id.IdIsSelected(Model.case_.Priority_Id.ToString()) >@Translation.Get(e.Name)</option>
                                                        }
                                                    }
                                                </select>
                                            }
                                            else
                                            {
                                                if (!Model.case_.Priority_Id.HasValue)
                                                {
                                                @Html.TextBoxFor(m => m.case_.Priority_Id, new { @readonly = true })
                                                }
                                                else
                                                {
                                                @Html.TextBoxFor(m => m.priorities.SingleOrDefault(x => x.Id == Model.case_.Priority_Id).Name, new { @readonly = true })
                                                @Html.HiddenFor(x => x.case_.Priority_Id)
                                                }
                                            }
                                        </td>
                                    </tr>
                                    <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.Status_Id, CaseSolutionFields.Status)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.Status_Id, "Status")
                                        </td>
                                        <td>
                                            @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.Status_Id, CaseSolutionFields.Status))
                                            {
                                                    <select id="case__Status_Id" name="case_.Status_Id">
                                                        <option value="">&nbsp;</option>
                                                        @if (Model.statuses != null)
                                                        {
                                                            foreach (var e in Model.statuses.Where(e => e.IsActive == 1 || Model.case_.Status_Id == e.Id))
                                                            {
                                                                @*<option value="@e.Id" @e.Id.IdIsSelected(Model.case_.Status_Id.ToString())>@e.Name</option>*@
                                                            <option value="@e.Id" @e.Id.IdIsSelected(Model.case_.Status_Id.ToString())>@Translation.Get(e.Name)</option>
                                                            }
                                                        }
                                                    </select>
                                            }
                                            else
                                            {
                                                if (!Model.case_.Status_Id.HasValue)
                                                {
                                                    @Html.TextBoxFor(m => m.case_.Status_Id, new { @readonly = true })
                                                }
                                                else
                                                {
                                                    @Html.TextBoxFor(m => m.statuses.SingleOrDefault(x => x.Id == Model.case_.Status_Id).Name, new { @readonly = true })
                                                    @Html.HiddenFor(x => x.case_.Status_Id)
                                                }
                                            }
                                        </td>
                                    </tr>
                                    <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.StateSecondary_Id, CaseSolutionFields.StateSecondary)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.StateSecondary_Id, "Understatus")
                                        </td>
                                        <td>
                                            @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.StateSecondary_Id, CaseSolutionFields.StateSecondary))
                                            {
                                                <select id="case__StateSecondary_Id" @Model.case_.Id.HtmlReadOnlyFlag(Model.customerUserSetting.StateSecondaryPermission) name="case_.StateSecondary_Id">
                                                    <option value="">&nbsp;</option>
                                                    @if (Model.stateSecondaries != null)
                                                    {
                                                        foreach (var e in Model.stateSecondaries.Where(e => e.IsActive == 1 || Model.case_.StateSecondary_Id == e.Id))
                                                        {
                                                        <option value="@e.Id" @e.Id.IdIsSelected(Model.case_.StateSecondary_Id.ToString()) >@Translation.Get(e.Name)</option>
                                                        }
                                                    }
                                                </select>
                                            }
                                            else
                                            {
                                                if (!Model.case_.StateSecondary_Id.HasValue)
                                                {
                                                    @Html.TextBoxFor(m => m.case_.StateSecondary_Id, new { @readonly = true })
                                                }
                                                else
                                                {
                                                    @Html.TextBoxFor(m => m.stateSecondaries.SingleOrDefault(x => x.Id == Model.case_.StateSecondary_Id).Name, new { @readonly = true })
                                                    @Html.HiddenFor(x => x.case_.StateSecondary_Id)
                                                }
                                            }
                                        </td>
                                    </tr>
                                    @if (Model.projects != null)
                                    {
                                        if (Model.projects.Any())
                                        {                                                                                        
                                        <tr class="displaytr" style="@Model.GetFieldStyle(CaseSolutionFields.Project)">
                                            <td>
                                                @Translation.Get("Projekt", SessionFacade.CurrentLanguageId)
                                            </td>
                                            <td>
                                                @if (!Model.IsReadOnly(CaseSolutionFields.Project))
                                                {
                                                    <select id="case__Project_Id" name="case_.Project_Id">
                                                        <option value="">&nbsp;</option>
                                                        @if (Model.projects != null)
                                                        {
                                                            foreach (var e in Model.projects.Where(e => e.IsActive == 1 || Model.case_.Project_Id == e.Id))
                                                            {
                                                            <option value="@e.Id" @e.Id.IdIsSelected(Model.case_.Project_Id.ToString()) >@e.Name</option>
                                                            }
                                                        }
                                                    </select>
                                                }
                                                else
                                                {
                                                    if (!Model.case_.Project_Id.HasValue)
                                                    {
                                                    @Html.TextBoxFor(m => m.case_.Project_Id, new { @readonly = true })
                                                    }
                                                    else
                                                    {
                                                    @Html.TextBoxFor(m => m.projects.SingleOrDefault(x => x.Id == Model.case_.Project_Id).Name, new { @readonly = true })
                                                    @Html.HiddenFor(x => x.case_.Project_Id)
                                                    }
                                                }
                                            </td>
                                        </tr>
                                        }
                                    }
                                    @if (Model.problems != null)
                                    {
                                        if (Model.problems.Any())
                                        {                                                                                        
                                        <tr class="displaytr" style="@Model.GetFieldStyle(CaseSolutionFields.Problem)">
                                            <td>
                                                @Translation.Get("ITIL Problem", SessionFacade.CurrentLanguageId)
                                            </td>
                                            <td>
                                                 @if (!Model.IsReadOnly(CaseSolutionFields.Project))
                                                 {
                                                    <select id="case__Problem_Id" name="case_.Problem_Id">
                                                        <option value="">&nbsp;</option>
                                                        @foreach (var e in Model.problems.Where(e => e.FinishingDate == null || Model.case_.Problem_Id == e.Id))
                                                        {
                                                            <option value="@e.Id" @e.Id.IdIsSelected(Model.case_.Problem_Id.ToString()) >@e.Name @(string.IsNullOrWhiteSpace(e.ResponsibleUserName) ? "" : "(" + @e.ResponsibleUserName + ")") </option>
                                                        }
                                                    </select>
                                                    <div id="divProblemResponsible" style="display: none">
                                                        @Translation.Get("Ansvarig", SessionFacade.CurrentLanguageId)
                                                    </div>
                                                 }
                                                 else
                                                 {
                                                     if (!Model.case_.Problem_Id.HasValue)
                                                     {
                                                    @Html.TextBoxFor(m => m.case_.Problem_Id, new { @readonly = true })
                                                     }
                                                     else
                                                     {
                                                        @Html.TextBoxFor(m => m.problems.SingleOrDefault(x => x.Id == Model.case_.Problem_Id).Name, new { @readonly = true })
                                                        @Html.HiddenFor(x => x.case_.Problem_Id)
                                                     }
                                                 }
                                            </td>
                                        </tr>
                                        }
                                    }
                                    <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.CausingPart, CaseSolutionFields.CausingPart)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.CausingPart, "Rotorsak")
                                        </td>
                                        <td class="span1" style="float: left;">
                                            @Html.HiddenFor(model => model.case_.CausingPartId, new { ModelId = "causing-type" })
                                            @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.CausingPart, CaseSolutionFields.CausingPart))
                                            {
                                                @Html.CausingPartList(Model.case_.Customer_Id, Model.case_.CausingPartId, "causing-type")
                                            }
                                            else
                                            {
                                                @Html.TextBoxFor(m => m.finishingCauses.SingleOrDefault(x => x.Id == Model.case_.CausingPartId).Name, new { @readonly = true })
                                                @Html.HiddenFor(x => x.case_.CausingPartId)
                                            }
                                        </td>
                                    </tr>
                                    @if (Model.changes != null)
                                    {
                                        if (Model.changes.Any())
                                        {                                           
                                        <tr class="displaytr" style="@Model.GetFieldStyle(CaseSolutionFields.Change)">
                                            <td>
                                                @Translation.Get("Ändring", SessionFacade.CurrentLanguageId)
                                            </td>
                                            <td>
                                                @if (!Model.IsReadOnly(CaseSolutionFields.Change))
                                                {
                                                    <select id="case__Change_Id" name="case_.Change_Id">
                                                        <option value="">&nbsp;</option>
                                                        @foreach (var e in Model.changes)
                                                        {
                                                            <option value="@e.Id" @e.Id.IdIsSelected(Model.case_.Change_Id.ToString()) >@e.ChangeTitle</option>
                                                        }
                                                    </select>
                                                }
                                                else
                                                {
                                                    if (!Model.case_.Change_Id.HasValue)
                                                    {
                                                        @Html.TextBoxFor(m => m.case_.Change_Id, new { @readonly = true })
                                                    }
                                                    else
                                                    {
                                                        @Html.TextBoxFor(m => m.changes.SingleOrDefault(x => x.Id == Model.case_.Change_Id).ChangeTitle, new { @readonly = true })
                                                        @Html.HiddenFor(x => x.case_.Change_Id)
                                                    }
                                                }
                                            </td>
                                        </tr>
                                        }
                                    }
                                    <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.PlanDate, CaseSolutionFields.PlanDate)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.PlanDate, "Planerad åtgärdsdatum")
                                        </td>
                                        <td>
                                            @*@Html.EditorFor(m => m.case_.PlanDate, "DatePicker", new { id = "divCase__PlanDate" })*@

                                            @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.PlanDate, CaseSolutionFields.PlanDate))
                                            {
                                                                                             
                                               @Html.EditorFor(m => m.case_.PlanDate, "DatePicker", new { id = "divCase__PlanDate" }) 
                                               
                                            }
                                            else
                                            {
                                                @Html.EditorFor(m => m.case_.PlanDate, "DateReadOnly")
                                            }

                                        </td>
                                    </tr>
                                    <tr style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.WatchDate, CaseSolutionFields.WatchDate)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.WatchDate, "Bevakningsdatum")
                                        </td>
                                        <td>
                                            @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.WatchDate, CaseSolutionFields.WatchDate))
                                            {
                                                if (Model.customerUserSetting.WatchDatePermission == 1 || Model.case_.Id == 0)
                                                {                                                
                                                    @Html.EditorFor(m => m.case_.WatchDate, "DatePicker", new { id = "divCase__WatchDate" }) 
                                                }
                                                else
                                                {                                            
                                                    @Html.EditorFor(m => m.case_.WatchDate, "DateReadOnly")                                                 
                                                }
                                            }
                                            else
                                            {
                                                @Html.EditorFor(m => m.case_.WatchDate, "DateReadOnly")
                                            }

                                        </td>
                                    </tr>
                                    <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.Verified, CaseSolutionFields.Verified)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.Verified, "Verifierad")
                                        </td>
                                        <td>
                                            @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.Verified, CaseSolutionFields.Verified))
                                            {
                                                <input type="checkbox" name="case_.Verified" @(Model.case_.Verified == 1 ? "checked=checked" : "") value="1"/>
                                            }
                                            else
                                            {
                                                <input type="checkbox" name="case_.Verified" @(Model.case_.Verified == 1 ? "checked=checked" : "") value="1" disabled="disabled"/>
                                            }
                                            <input type="hidden" name="case_.Verified" value="0" />
                                        </td>
                                    </tr>
                                    <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.VerifiedDescription, CaseSolutionFields.VerifiedDescription)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.VerifiedDescription, "Verifierad beskrivning")
                                        </td>
                                        <td title="@Model.case_.VerifiedDescription">
                                            @if (!Model.IsReadOnly(GlobalEnums.TranslationCaseFields.VerifiedDescription, CaseSolutionFields.VerifiedDescription))
                                            {
                                                @Html.TextBoxFor(model => model.case_.VerifiedDescription, new { maxlength = "200" })
                                            }
                                            else
                                            {
                                                @Html.TextAreaFor(model => model.case_.VerifiedDescription, new { @readonly = true })
                                            }
                                        </td>
                                    </tr>
                                    <tr class="displaytr" style="@Model.GetFieldStyle(GlobalEnums.TranslationCaseFields.SolutionRate, CaseSolutionFields.SolutionRate)">
                                        <td>
                                            @CaseFieldCaption(GlobalEnums.TranslationCaseFields.SolutionRate, "Lösningsgrad")
                                        </td>
                                        <td>
                                            @if (!Model.IsReadOnly(CaseSolutionFields.SolutionRate))
                                            {
                                                    <select id="case__SolutionRate" name="case_.SolutionRate">
                                                        <option value="">&nbsp;</option>
                                                        @for (var i = 10; i < 110; i = i + 10)
                                                        {
                                                            <option value="@i.ToString()" @i.IdIsSelected(Model.case_.SolutionRate) >@i.ToString()</option>
                                                        }
                                                    </select>
                                            }
                                            else
                                            {
                                                if (Model.case_.SolutionRate != null)
                                                {
                                                    @Html.TextBoxFor(m => m.case_.SolutionRate, new { @readonly = true })
                                                }
                                                else
                                                {
                                                    @Html.TextBoxFor(m => m.case_.SolutionRate, new { @readonly = true })
                                                    @Html.HiddenFor(x => x.case_.SolutionRate)
                                                }
                                            }
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        @if (Model.case_.Id != 0)
                        {
                            <div class="displaytr" class="container">
                                <ul class="nav nav-tabs" id="logandhistorytabs">
                                    <li class="active"><a href="#logtab">@Translation.Get("Ärendelogg", SessionFacade.CurrentLanguageId)</a></li>
                                    <li><a href="#historytab">@Translation.Get("Historik", SessionFacade.CurrentLanguageId)</a></li>
                                </ul>
                                <div class="tab-content">
                                    @Html.Partial("_CaseLog", Model)
                                    @Html.Partial("_CaseHistory", Model)
                                </div>
                            </div>
                        }
                    </div>
                        
                        @if (Model.case_.FinishingDate.HasValue)
                        {
                            <h4>
                                @Translation.Get("Status")
                            </h4>    
                            <div class="row">
                                <div class="span12">
                                    <table class="tableform">
                                        <thead>
                                            <tr>
                                                <th class="span3"></th>
                                                <th class="span4"></th>
                                                <th class="span5"></th>
                                            </tr>
                                        </thead>
                                        <tr>
                                            <td>
                                                @Translation.Get("Avslutsorsak", SessionFacade.CurrentLanguageId)
                                            </td>
                                            <td>
                                                @Model.FinishingCause
                                            </td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td>
                                                @CaseFieldCaption(GlobalEnums.TranslationCaseFields.FinishingDate, "Avslutsdatum")
                                            </td>
                                            <td>
                                                @Html.DisplayFor(m => m.case_.FinishingDate.Value, "Date")
                                            </td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td>
                                                @CaseFieldCaption(GlobalEnums.TranslationCaseFields.FinishingDescription, "Avslutsbeskrivning")
                                            </td>
                                            <td>
                                                @Model.case_.FinishingDescription
                                            </td>
                                            <td></td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        }
                        else
                        {
                            if (Model.CaseLock == null || (Model.CaseLock != null && !Model.CaseLock.IsLocked))
                            {
                                @Html.Partial("_CaseLogInput", Model)
                            }
                        }
                    </div>
                </div>
                @if (Model.DynamicCase != null && !Model.DynamicCase.Modal)
                {
                    <div id="dh-form-area" class="tab-pane tab-pane-border">
                    </div>
                }
            </div>
        </div>
    </div>
    <div id="overwriteDlg" class="modal fade" style="display: none">
        <div class="modal-dialog">
            <div class="modal-body">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <p class="alert alert-info infop">@Translation.Get("Det finns information som kan bli ändrad. Vill du skriva över?")</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-ok">@Translation.Get("Ja")</button>
                <button type="button" class="btn btn-cancel">@Translation.Get("Nej")</button>
            </div>
        </div>
    </div>
}

@functions    {

    private MvcHtmlString CaseFieldCaption(GlobalEnums.TranslationCaseFields field, string defaultCaption = "")
    {
        var res =
           Html.CaseFieldCaption(
                    Model.caseFieldSettings,
                    Model.CaseFieldSettingWithLangauges,
                    field,
                    Model.case_.Customer_Id,
                    SessionFacade.CurrentLanguageId,
                    defaultCaption);

        return res;
    }

}


<script type="text/javascript">

    var validator = $("#target").validate({
        ignore: "",
        rules: {
            "case_.ReportedBy": {
                required: @Json.Encode(@Model.IsRequired(GlobalEnums.TranslationCaseFields.ReportedBy, CaseSolutionFields.UserNumber))  
                },
            "case_.PersonsName": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.Persons_Name.ToString())")
            },
            "case_.PersonsEmail": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.Persons_EMail.ToString())")
            },
            "case_.PersonsCellPhone": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.Persons_CellPhone.ToString())")
            },
            "case_.PersonsPhone": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.Persons_Phone.ToString())")
            },
            "case_.Region_Id": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.Region_Id.ToString())")
            },
            "case_.Department_Id": {
                required: @Json.Encode(@Model.IsRequired(GlobalEnums.TranslationCaseFields.Department_Id, CaseSolutionFields.Department))  
                },
            "case_.OU_Id": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.OU_Id.ToString())")
            },
            "case_.Place": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.Place.ToString())")
            },
            "case_.UserCode": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.UserCode.ToString())")
            },
            "case_.InventoryNumber": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.InventoryNumber.ToString())")
            },
            "case_.InventoryLocation": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.InventoryLocation.ToString())")
            },
            "case_.ComputerType_Id": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.ComputerType_Id.ToString())")
            },
            "case_.ProductArea_Id": {
                required: @Json.Encode(@Model.IsRequired(GlobalEnums.TranslationCaseFields.ProductArea_Id, CaseSolutionFields.ProductArea))  
                },
            "case_.CaseType_Id": {
                required: @Json.Encode(@Model.IsRequired(GlobalEnums.TranslationCaseFields.CaseType_Id, CaseSolutionFields.CaseType))  
                },
            "case_.System_Id": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.System_Id.ToString())")
            },
            "case_.Urgency_Id": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.Urgency_Id.ToString())")
            },
            "case_.Impact_Id": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.Impact_Id.ToString())")
            },
            "case_.Category_Id": {
                required: @Json.Encode(@Model.IsRequired(GlobalEnums.TranslationCaseFields.Category_Id, CaseSolutionFields.Category))  
                },
            "case_.Supplier_Id": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.Supplier_Id.ToString())")
            },
            "case_.InvoiceNumber": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.InvoiceNumber.ToString())")
            },
            "case_.ReferenceNumber": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.ReferenceNumber.ToString())")
            },
            "case_.Caption": {
                required: @Json.Encode(@Model.IsRequired(GlobalEnums.TranslationCaseFields.Caption, CaseSolutionFields.Caption))  
                },
            "case_.Description": {
                required: @Json.Encode(@Model.IsRequired(GlobalEnums.TranslationCaseFields.Description, CaseSolutionFields.Description))  
                },
            "case_.Miscellaneous": {
                required: @Json.Encode(@Model.IsRequired(GlobalEnums.TranslationCaseFields.Miscellaneous, CaseSolutionFields.Miscellaneous))  
                },
            "case_.AgreedDate": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.AgreedDate.ToString())")
            },
            "case_.Available": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.Available.ToString())")
            },
            "case_.WorkingGroup_Id": {
                required: @Json.Encode(@Model.IsRequired(GlobalEnums.TranslationCaseFields.WorkingGroup_Id, CaseSolutionFields.WorkingGroup))  
                },
            "ResponsibleUser_Id": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.CaseResponsibleUser_Id.ToString())")
            },
            "Performer_Id": {
                required: @Json.Encode(@Model.IsRequired(GlobalEnums.TranslationCaseFields.Performer_User_Id, CaseSolutionFields.Administrator))  
            },
            "case_.Priority_Id": {
                required: @Json.Encode(@Model.IsRequired(GlobalEnums.TranslationCaseFields.Priority_Id, CaseSolutionFields.Priority))  
                },
            "case_.Status_Id": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.Status_Id.ToString())")
            },
            "case_.StateSecondary_Id": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.StateSecondary_Id.ToString())")
            },
            "case_.PlanDate": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.PlanDate.ToString())")
            },
            "case_.WatchDate": {
                required: FieldIsRequired("@Model.caseFieldSettings.CaseFieldSettingRequiredCheck(GlobalEnums.TranslationCaseFields.WatchDate.ToString())")
            },
            "CaseLog.FinishingType": {
                required: function(){
                    if ($('#CaseLog_FinishingDate').closest('tr').css('display') != 'none' && $('#CaseLog_FinishingType').closest('tr').css('display') != 'none')
                    {
                        if (($('#CaseLog_FinishingDate').val() == "" || $('#CaseLog_FinishingDate').val() == null) && @Json.Encode(@Model.IsRequired(GlobalEnums.TranslationCaseFields.FinishingDate, CaseSolutionFields.FinishingDate)) == false)
                        {
                            return false;
                        }
                        else
                        {
                            return true;
                        }
                    }
                    else{
                        return false;
                    }
                }
                },
            "CaseLog.FinishingDate": {
                required: function()
                {
                    if ($('#CaseLog_FinishingType').closest('tr').css('display') != 'none' && $('#CaseLog_FinishingDate').closest('tr').css('display') != 'none')
                    {
                        if ($('#CaseLog_FinishingType').val() == "" && @Json.Encode(@Model.IsRequired(GlobalEnums.TranslationCaseFields.ClosingReason, CaseSolutionFields.FinishingCause)) == false)
                        {
                            return false;
                        }
                        else{
                            return true;
                        }
                    }
                    else{
                        return false;
                    }
                }
            },
            "CaseLog.TextExternal": {
                maxlength: 3000
            },
            "CaseLog.TextInternal": {
                maxlength: 3000
            }            
        },
        messages: {
            "case_.ReportedBy": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.ReportedBy.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.PersonsName": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.Persons_Name.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.PersonsEmail": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.Persons_EMail.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.PersonsCellPhone": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.Persons_CellPhone.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.PersonsPhone": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.Persons_Phone.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.Region_Id": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.Region_Id.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.Department_Id": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.Department_Id.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.OU_Id": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.OU_Id.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.Place": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.Place.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.UserCode": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.UserCode.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.InventoryNumber": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.InventoryNumber.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.InventoryLocation": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.InventoryLocation.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.ComputerType_Id": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.ComputerType_Id.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.ProductArea_Id": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.ProductArea_Id.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.CaseType_Id": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.CaseType_Id.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.System_Id": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.System_Id.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.Urgency_Id": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.Urgency_Id.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.Impact_Id": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.Impact_Id.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.Category_Id": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.Category_Id.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.Supplier_Id": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.Supplier_Id.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.InvoiceNumber": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.InvoiceNumber.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.ReferenceNumber": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.Category_Id.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.Caption": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.Caption.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.Description": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.Description.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.Miscellaneous": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.Miscellaneous.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.AgreedDate": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.AgreedDate.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.Available": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.Available.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.WorkingGroup_Id": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.WorkingGroup_Id.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.Performer_User_Id": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.Performer_User_Id.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.CaseResponsible_User_Id": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.CaseResponsibleUser_Id.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.Priority_Id": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.Priority_Id.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.Status_Id": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.Status_Id.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.StateSecondary_Id": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.StateSecondary_Id.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.PlanDate": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.PlanDate.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "case_.WatchDate": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.WatchDate.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "CaseLog.FinishingType": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.ClosingReason.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            },
            "CaseLog.FinishingDate": {
                required: "@Translation.Get(GlobalEnums.TranslationCaseFields.FinishingDate.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id) @Translation.Get("måste anges")"
            }          
        },
        //errorPlacement: function (error, element) {
        //    alert(error.text());
        //},
        submitHandler: function(form) {             
            
            if (!isProductAreaValid())            
                return false;
            
            if (window.parameters.currentCaseId > 0)
            {
                $.post(window.parameters.caseLockChecker, { caseId: window.parameters.currentCaseId, 
                                                            lockGuid: window.parameters.caseLockGuid },
                    function (data) {
                        if (data == true)
                            form.submit();   
                        else
                        {
                            //Case is Locked
                            ShowToastMessage(window.parameters.saveLockedCaseMessage, "error", true);
                            return false;                    
                        }
                    });   
            }
            else
                form.submit();   
        }
    });

    function isProductAreaValid() {
        var ret = true;
        var res = $("#ProductAreaHasChild").val();
        if (res == '1') {
            ret = false;
            ShowToastMessage(window.parameters.productAreaErrorMessage, "error", true);
        }
        return ret;
    }

    function FieldIsRequired(value) {
        var ret = false;
        if (value == '1') {
            ret = true;
        }
        return ret;
    }


    $(function() {        

        $("#caseDescriptionPreview").click(function() {
            var description = $(".case-description")
                .attr("value")
                .replace(/\r\n|\r|\n/g, "<br />");
            var d = $(document.createElement("div"))
                .html(description)
                .dialog({
                    title: "@Translation.Get(GlobalEnums.TranslationCaseFields.Description.ToString(), Enums.TranslationSource.CaseTranslation, Model.case_.Customer_Id)",    
                    modal: true,
                    width: 600,
                    height: 400,
                    close: function() {
                        d.dialog("destroy");
                    }
                });
        });

        $(".case-description").keyup(function(ev) {
            var visibility = 'visible';
            if (ev.target.value.length == 0) {
                visibility = 'hidden';
            }
            $("#caseDescriptionPreview").css('visibility', visibility);
        });

        @if (Model.DynamicCase != null && !Model.DynamicCase.Modal)
        {
         <text>

        var tab = $("#myTab li a");

        tab.on('shown', function (e) {
            window.scrollTo(0, 0);
        });

        tab.click(function(ev) {

            if (ev.target.className.indexOf("case") >= 0) {
                if ($(".secnav").hasClass("hide")) {
                    $(".secnav").fadeIn(300, function () {
                        $(".secnav").removeClass("hide");
                    });
                }

                location.reload(true);
            }

            if (ev.target.className.indexOf("eform") >= 0) {
                var secnav = $(".secnav");
                if (secnav.hasClass("hide") == false) {
                    secnav.fadeOut(300, function () {
                        secnav.addClass("hide");
                    });
                }
            }
        });

        </text>
        }

        var scope = dhHelpdesk.cases.scope({
            requiredFieldsMessage: '@Translation.Get("Ärendet kunde inte sparas då det saknas data i ett eller flera obligatoriska fält. Var vänlig kontrollera i ärendet.")',
            getDepartmentsUrl: '@Url.Action("GetDepartments", "Ajax")',
            getDepartmentUsersUrl: '@Url.Action("GetDepartmentUsers", "Ajax")',
            relatedCasesUrl: '@Url.Action("RelatedCasesFull", "Cases")',
            relatedCasesCountUrl: '@Url.Action("RelatedCasesCount", "Cases")',
            getDepartmentOusUrl: '@Url.Action("ChangeDepartment", "Cases")',
            deleteCaseFileConfirmMessage: '@Translation.Get("Är du säker på att du vill ta bort bifogad fil")' + '?',
            okText: '@Translation.Get("OK")',
            cancelText: '@Translation.Get("Avbryt")',
            yesText: '@Translation.Get("Ja")',
            noText: '@Translation.Get("Nej")',
            validationMessages: ['@Translation.Get("måste anges")'],
            mandatoryFieldsText: '@Translation.Get("Obligatoriska fält")',            
        });        
        
    });
</script>
